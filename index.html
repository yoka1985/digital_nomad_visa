<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Nomad Visa Matcher</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Analytics Gtag Script -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6N573S8D8S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'analytics_storage': 'denied' });
        function initGoogleAnalytics() {
            gtag('consent', 'update', { 'analytics_storage': 'granted' });
            gtag('js', new Date());
            gtag('config', 'G-6N573S8D8S');
            console.log("Google Analytics Initialized");
        }
    </script>
    
    <style>
        body { background-color: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #334155; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
        .group:hover .group-hover\:block { display: block; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            background: #a78bfa; cursor: pointer; border-radius: 50%; margin-top: -6px;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: #a78bfa; cursor: pointer; border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA & CONTENT ---
        const visaData = [
          { "country": "Spain", "visa_name": "Digital Nomad Visa", "visa_cost_usd": 153, "income_requirements_monthly_usd": 2762, "visa_length_months": 12, "category_citizenship": ["Non-EU/EEA/Swiss"], "bonuses_incentives": "20% tax cap; family members allowed; eventual path to residency", "ssn_attractiveness": 2, "tax_attractiveness": 4, "cost_of_living_attractiveness": 3, "bureaucracy_level": 4 },
          { "country": "Portugal", "visa_name": "D8 Digital Nomad Visa", "visa_cost_usd": 165, "income_requirements_monthly_usd": 3480, "visa_length_months": 24, "category_citizenship": ["Non-EU/EEA/Swiss"], "bonuses_incentives": "Access to Schengen; path to permanent residency and citizenship", "ssn_attractiveness": 3, "tax_attractiveness": 4, "cost_of_living_attractiveness": 4, "bureaucracy_level": 4 },
          { "country": "Thailand", "visa_name": "Destination Thailand Visa (DTV)", "visa_cost_usd": 270, "income_requirements_monthly_usd": 0, "visa_length_months": 60, "category_citizenship": ["All"], "bonuses_incentives": "5-year validity, 180-day entries, very flexible, no income requirement", "remarks": "Requires proof of 500k THB in savings.", "ssn_attractiveness": 5, "tax_attractiveness": 4, "cost_of_living_attractiveness": 5, "bureaucracy_level": 2 }
        ];

        const legalContent = {
            terms: { title: 'Terms of Use', content: `Welcome to our Digital Nomad Visa Matcher... For any questions, please contact us at 10mvpsin20days@gmail.com.` },
            privacy: { title: 'Privacy Policy', content: `This Privacy Policy describes how we handle your information... please contact us at 10mvpsin20days@gmail.com.` },
            about: { 
                title: 'About This Project', 
                story: `My name is Yonatan, and I've been living the digital nomad life for the past several years. With a background in tech, I grew increasingly frustrated with the inconsistent, outdated, and often confusing visa information scattered across the web.\n\nI built this tool to solve my own problem: to create a single, clear, and user-friendly place to compare visa options without the headache. My goal is to reduce the bureaucratic pain for fellow nomads.\n\nData on this site is aggregated from official government websites, reputable legal and immigration blogs, and cross-referenced with validated user experiences from online communities like Reddit.`,
                disclaimer: `Information keeps changing, and updates are currently done on a monthly average, so it's always better to double-check official sources.`,
                closing: `I hope this serves you well, and I'm always open to suggestions for improvement!`,
                imageSrc: 'https://i.imgur.com/kQoA1m5.jpeg', 
                imageCaption: "Me in DurrÃ«s beach, Albania, a day before the official end of season (shoulder seasons for the win!)"
            }
        };

        const incomeLevels = [
            { label: "Any", value: "any", userIncomeForMatch: null }, { label: "< $2k", value: "0-1999", userIncomeForMatch: 1999 }, { label: "$2k-4k", value: "2000-3999", userIncomeForMatch: 3999 }, { label: "$4k+", value: "4000+", userIncomeForMatch: Infinity }
        ];

        const citizenshipRegions = [
            { value: "All", label: "For All Nationalities" }, { value: "Non-EU/EEA/Swiss", label: "For Non-EU/EEA/Swiss Citizens" }, { value: "Non-EU/EFTA", label: "For Non-EU/EFTA Citizens (EFTA: Iceland, Liechtenstein, Norway, Switzerland)" }, { value: "OECD Nationals", label: "For OECD Nationals" }, { value: "Most Nationalities", label: "For Most Nationalities" }, { value: "Select Countries", label: "For Other Specific Nationalities" }
        ];
        
        const walkthroughData = {
          Spain: {
            title: "Spain DNV: User Experience Walkthrough",
            steps: [
              { title: "Step 1: Choose Your Path: Apply Abroad vs. In Spain", officialInfo: "You can apply at a Spanish Consulate for a 1-year visa, or apply as a tourist from within Spain for a 3-year permit.", insights: [{ text: "Applying within Spain grants a 3-year residency permit, unlike the 1-year visa from consulates. This is a huge advantage but requires careful timing.", metric: "Widely Corroborated, 2024/2025" }], links: [{label: "Find Your Spanish Consulate", url: "https://www.exteriores.gob.es/en/EmbajadasConsulados/Paginas/index.aspx"}, {label: "National Visa Application Form", url: "https://www.exteriores.gob.es/Consulados/londres/en/ServiciosConsulares/Paginas/Consular/Visado-de-teletrabajo.aspx"}] },
              { title: "Step 2: Get a Criminal Record Check", officialInfo: "A criminal background check from your country of residence for the last 2-5 years is required. For US citizens, this is an FBI Identity History Summary.", insights: [{ text: "This is the first document you should request as it can take time to arrive.", metric: "Community Advice" }], links: [{label: "Get a US FBI Background Check", url: "https://www.fbi.gov/services/cjis/identity-history-summary-checks"}] },
              { title: "Step 3: Get the Apostille", officialInfo: "The criminal record check must be legalized with an Apostille of The Hague.", insights: [{ text: "This process can take weeks or months depending on your country. Do not skip this, or your document is invalid.", metric: "Critical Requirement" }], links: [] },
              { title: "Step 4: Get a Sworn Translation", officialInfo: "All non-Spanish official documents must be translated by a 'traductor jurado' recognized by Spain.", insights: [{ text: "Only use an official sworn translator. A regular translation will be rejected. This is a common and costly mistake.", metric: "Multiple User Warnings, 2024" }], links: [{label: "Find an Official Sworn Translator", url: "https://www.exteriores.gob.es/en/ServiciosAlCiudadano/Paginas/Traductores-Interpretes-Jurados.aspx"}] },
              { title: "Step 5: Gather Work & Income Proof", officialInfo: "You must prove a stable income source and that you have been working for at least 3 months.", insights: [{ text: "Over-prepare this section. Provide contracts, letters from clients/employers, invoices, and bank statements showing consistent payments.", metric: "Community Best Practice" }], links: [] },
              { title: "Step 6: Handle the US W2 Roadblock", officialInfo: "US employees must provide an A-1 Certificate of Coverage from the SSA.", insights: [{ text: "This is nearly impossible. The A-1 takes 6-9+ months to get. The ONLY reliable workaround is to switch to a 1099 independent contractor status before applying.", metric: "Major Pain Point, Multiple Threads" }], links: [{label: "US Social Security Administration (A-1)", url: "https://www.ssa.gov/international/CoC_requests.html"}] },
              { title: "Step 7: Get Spanish Health Insurance", officialInfo: "A private health insurance policy from an insurer authorized in Spain is required.", insights: [{ text: "The policy must have zero co-payments or deductibles. Travel insurance is not sufficient.", metric: "Common Application Error" }], links: [] },
              { title: "Step 8: Submit the Application", officialInfo: "Submit all documents via the appropriate channel.", insights: [{ text: "If applying from your home country, book an appointment at the consulate. If applying in Spain, you will likely need a lawyer to submit through the UGE online portal.", metric: "Procedural Tip" }], links: [] },
              { title: "Step 9: Wait for Approval (Administrative Silence)", officialInfo: "The official processing time is 20 working days.", insights: [{ text: "This is misleading. If you don't hear back in 20 days, it is considered 'administrative silence' which is a tacit approval. However, the full process takes much longer.", metric: "22 Upvotes, Early 2024" }], links: [] },
              { title: "Step 10: Register Your Address (Empadronamiento)", officialInfo: "Upon arrival, you must register your address at the local town hall (ayuntamiento).", insights: [{ text: "Do this as soon as you have a rental contract. You will need the 'padrÃ³n' certificate for your TIE appointment.", metric: "Essential First Step in Spain" }], links: [] },
              { title: "Step 11: The TIE Appointment Hunt", officialInfo: "You must book a TIE (residency card) fingerprinting appointment.", insights: [{ text: "This is the hardest part. The official website rarely has slots. Pro Tip: Use a Telegram bot (like citapreviabot.com) or pay a 'gestor' (~â¬30-â¬50) to book one for you.", metric: "Highly Validated, Late 2023/2024" }], links: [{label: "Official TIE Appointment Booking Site", url: "https://sede.administracionespublicas.gob.es/pagina/index/directorio/icpplus"}] },
              { title: "Step 12: Get Your TIE Card", officialInfo: "After your fingerprinting appointment, you will be told when to return to pick up your physical card.", insights: [{ text: "The wait for the physical card can be another 4-6 weeks after the appointment. The entire end-to-end process from starting paperwork to having your TIE card in hand is realistically 6-9+ months.", metric: "Community Timeline Data" }], links: [] },
            ]
          },
          Portugal: {
             title: "Portugal D8: User Experience Walkthrough",
            steps: [
              { title: "Step 1: Hire a Lawyer or Service", officialInfo: "The process requires obtaining Portuguese legal and financial documents.", insights: [{ text: "Don't try to do this alone from abroad. Your first step should be hiring a lawyer or a service like Bordr to get your NIF and open a bank account.", metric: "Universal Advice" }], links: [] },
              { title: "Step 2: Get a NIF (Tax Number)", officialInfo: "A Portuguese Tax Identification Number (NIF) is required for all transactions.", insights: [{ text: "This is your key to everything in Portugal. It can be obtained remotely through your legal representative.", metric: "Essential First Step" }], links: [{label: "Get a NIF Online (Service Provider)", url: "https://www.nifonline.pt/"}] },
              { title: "Step 3: Open a Portuguese Bank Account", officialInfo: "Proof of a Portuguese bank account is a core requirement.", insights: [{ text: "Your lawyer/service will facilitate this. Once open, you must wire transfer your proof of funds.", metric: "Mandatory Prerequisite" }], links: [] },
              { title: "Step 4: Prove Sufficient Funds", officialInfo: "Applicants must show they can support themselves for one year.", insights: [{ text: "Deposit at least â¬9,840 into your new Portuguese bank account. This is a firm requirement and the statement must be from the Portuguese bank.", metric: "Non-Negotiable Step" }], links: [] },
              { title: "Step 5: The 12-Month Lease Paradox", officialInfo: "Proof of long-term accommodation is required.", insights: [{ text: "This is the most painful step. Most consulates demand a signed 12-month lease. This means paying rent on an empty flat for months while you wait. Pro Tip: Use a service like Flatio that provides visa-compliant lease documents.", metric: "18 Upvotes, Mid-2024" }], links: [{label: "Find Compliant Leases on Flatio", url: "https://www.flatio.com/"}] },
              { title: "Step 6: The Consulate Appointment", officialInfo: "Apply at the Portuguese consulate in your country of residence.", insights: [{ text: "Processing times vary wildly by consulate (22 days to 183+ days). Research your specific consulate's recent performance on community forums before applying.", metric: "Community Data" }], links: [{label: "Find your Portuguese Consulate", url: "https://vistos.mne.gov.pt/en/world-area"}, {label: "VFS Global Portal (Example for USA)", url: "https://www.vfsglobal.com/portugal/usa/index.html"}] },
              { title: "Step 7: The AIMA Backlog", officialInfo: "If approved, you get a 4-month visa to enter and attend a residency appointment with AIMA.", insights: [{ text: "The real bottleneck is AIMA, which is severely backlogged. Expect to wait 8+ months for your residency card after arriving.", metric: "Well-Documented Crisis, 2023/2024" }], links: [] },
              { title: "Step 8: Legal Limbo", officialInfo: "Your initial visa is valid for 4 months.", insights: [{ text: "Your 4-month visa WILL expire while you wait for your AIMA appointment. While you are legal inside Portugal, you are trapped and CANNOT travel in the Schengen Area until your card arrives.", metric: "5 Upvotes, Mid-2024" }], links: [] },
              { title: "Step 9: Tax Reality", officialInfo: "New residents are subject to Portuguese taxation.", insights: [{ text: "The old NHR tax scheme is over for new applicants. The new program is highly restrictive. Plan your finances assuming you will pay standard Portuguese progressive income tax.", metric: "Key Financial Advice" }], links: [] },
              { title: "Step 10: Citizenship Timeline Reality", officialInfo: "Portugal offers a path to citizenship after 5 years of residency.", insights: [{ text: "The 5-year clock is real, but the process takes longer. After 5 years, the citizenship application itself has a 2-3 year backlog. Plan for a 7-8 year total journey to get a passport.", metric: "Community Consensus, Late 2023" }], links: [] },
              { title: "Step 11 (D7 Only): Passive Income Requirement", officialInfo: "The D7 visa is for those with passive income.", insights: [{ text: "This is for income from pensions, rentals, dividends, etc. It is NOT for remote work income. Applying with active income for the D7 is a common reason for rejection.", metric: "Critical Distinction" }], links: [] },
              { title: "Step 12 (D8 Only): Active Income Requirement", officialInfo: "The D8 visa is for remote workers with active income.", insights: [{ text: "The income requirement of â¬3,280/month is strict. Savings cannot be used as a substitute for active remote work income.", metric: "Upvoted Comment" }], links: [] }
            ]
          },
          Thailand: {
            title: "Thailand DTV: User Experience Walkthrough",
            steps: [
                { title: "Step 1: Application Strategy", officialInfo: "The Destination Thailand Visa (DTV) is a 5-year visa for long-term tourists and remote workers.", insights: [{ text: "The 'Soft Power' Path is easiest. Enroll in a long-term Muay Thai, language, or cooking course. The enrollment letter simplifies your application, bypassing complex employment proof.", metric: "Multiple Threads, 2024/2025" }], links: [] },
                { title: "Step 2: Prove Your Financial Stability", officialInfo: "Applicants must provide proof of funds.", insights: [{ text: "You need proof of savings of at least 500,000 THB (approx. $13,600 USD) in a bank account. You'll need official statements from the last 3-6 months.", metric: "Core Requirement" }], links: [] },
                { title: "Step 3: Consulate Shopping is CRITICAL", officialInfo: "Applications must be submitted online to a Thai embassy outside of Thailand.", insights: [{ text: "This is the most important step. Rules vary wildly by embassy. Pro Tip: Apply from a neighboring country like Laos or Vietnam. They are known to be much faster (3 days) and more lenient than Western consulates.", metric: "Central Theme in DTV Discussions" }], links: [{label: "Official Thai E-Visa Portal", url: "https://www.thaievisa.go.th/"}] },
                { title: "Step 4: The 'Border Bounce' Strategy", officialInfo: "Each entry grants a 180-day stay, which can be extended once in-country.", insights: [{ text: "Do not bother with the in-country extension. It's a bureaucratic nightmare. The universal advice is to do a simple 'border bounce'âa short trip to a nearby countryâto get a fresh 180-day stamp upon re-entry. It's cheaper, faster, and stress-free.", metric: "Community Consensus, 2024" }], links: [] },
                { title: "Step 5: 90-Day Reporting & TM.30", officialInfo: "Foreigners staying long-term must report their address every 90 days.", insights: [{ text: "This is a strict and enforced requirement. Additionally, your landlord must file a TM.30 form to report your stay. Ensure they do this, as it can cause issues for you later.", metric: "Mandatory Task" }], links: [{label: "90-Day Reporting Portal", url: "https://www.immigration.go.th/en/"}] },
                 { title: "Step 6: Tax Reality Check", officialInfo: "Long-term residents may be subject to Thai income tax.", insights: [{ text: "If you stay over 180 days in a calendar year, you are a tax resident. While enforcement is currently difficult for those without a Thai bank account, this is a significant legal grey area that could change. Consult a tax advisor for long-term stays.", metric: "62 Upvotes, May 2025" }], links: [] }
            ]
          }
        };

        const COUNTRY_CODE_MAP = { 'Spain': 'ES', 'Portugal': 'PT', 'Italy': 'IT', 'Croatia': 'HR', 'Germany': 'DE', 'Greece': 'GR', 'Estonia': 'EE', 'Malta': 'MT', 'Norway': 'NO', 'Iceland': 'IS', 'Romania': 'RO', 'Netherlands': 'NL', 'Georgia': 'GE', 'Czech Republic': 'CZ', 'Hungary': 'HU', 'Bulgaria': 'BG', 'Latvia': 'LV', 'Cyprus': 'CY', 'Costa Rica': 'CR', 'Mexico': 'MX', 'Panama': 'PA', 'Brazil': 'BR', 'Colombia': 'CO', 'Barbados': 'BB', 'Mauritius': 'MU', 'Uruguay': 'UY', 'Chile': 'CL', 'Philippines': 'PH', 'South Korea': 'KR', 'UAE': 'AE', 'Thailand': 'TH', 'Indonesia': 'ID' };
        
        function getCountryFlagEmoji(countryName) {
            const countryCode = COUNTRY_CODE_MAP[countryName];
            if (!countryCode) return 'ð³ï¸';
            return String.fromCodePoint(...[...countryCode.toUpperCase()].map(char => char.charCodeAt(0) + 127397));
        }
        
        const getScoreAttributes = (score, type = 'standard') => {
            const maxScore = 5;
            const standardDesc = ['Very Poor', 'Poor', 'Average', 'Good', 'Excellent'];
            const bureaucracyDesc = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
            const costDesc = ['Very High', 'High', 'Moderate', 'Low', 'Very Low'];
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#10b981']; 
            
            if (score === null || score === undefined || score < 1 || score > maxScore) {
                return { description: 'N/A', color: '#64748b', percentage: 0 };
            }
            const index = Math.round(score) - 1;
            let description;
            let currentColors = colors;

            if (type === 'bureaucracy') {
                description = bureaucracyDesc[index];
                currentColors = colors.slice().reverse();
            } else if (type === 'cost_of_living') {
                description = costDesc[index];
            }
             else {
                description = standardDesc[index];
            }

            return { description, color: currentColors[index], percentage: (score / maxScore) * 100 };
        };
        
        // --- COMPONENTS ---
        function App() {
            const [selectedRegion, setSelectedRegion] = React.useState('');
            const [selectedIncomeValue, setSelectedIncomeValue] = React.useState("any");
            const [maxVisaCost, setMaxVisaCost] = React.useState(3000);
            const [minTaxAttractiveness, setMinTaxAttractiveness] = React.useState(1);
            const [minVisaLength, setMinVisaLength] = React.useState(1);

            const [filteredVisas, setFilteredVisas] = React.useState([]);
            const [modalContent, setModalContent] = React.useState(null);
            const [legalModalContent, setLegalModalContent] = React.useState(null);
            const [walkthroughContent, setWalkthroughContent] = React.useState(null);
            const [showBanner, setShowBanner] = React.useState(false);
            
            React.useEffect(() => {
                if (localStorage.getItem('ga_consent') !== 'true') setShowBanner(true);
                else initGoogleAnalytics();
            }, []);

            React.useEffect(() => {
                if (!selectedRegion) {
                    setFilteredVisas([]);
                    return;
                }

                const incomeOption = incomeLevels.find(level => level.value === selectedIncomeValue);
                const userIncome = incomeOption?.userIncomeForMatch;

                const results = visaData.filter(visa => {
                    const isForEveryone = visa.category_citizenship.includes("All");
                    const isRegionMatch = visa.category_citizenship.includes(selectedRegion);
                    
                    if (selectedRegion !== "All" && !isForEveryone && !isRegionMatch) {
                        return false;
                    }
                    
                    if (userIncome !== null && visa.income_requirements_monthly_usd > userIncome) return false;
                    if (visa.visa_cost_usd > maxVisaCost) return false;
                    if (visa.tax_attractiveness < minTaxAttractiveness) return false;
                    if (visa.visa_length_months < minVisaLength) return false;
                    
                    return true;
                });
                setFilteredVisas(results);
            }, [selectedRegion, selectedIncomeValue, maxVisaCost, minTaxAttractiveness, minVisaLength]);

            const handleConsent = () => {
                localStorage.setItem('ga_consent', 'true');
                setShowBanner(false);
                if (typeof initGoogleAnalytics === 'function') initGoogleAnalytics();
            };
            
            const openWalkthrough = (country) => {
                setModalContent(null);
                setWalkthroughContent(walkthroughData[country]);
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 font-sans p-4 sm:p-6 md:p-8">
                    <header className="text-center mb-4 max-w-3xl mx-auto">
                        <h1 className="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                            Visa Match & Clarity Engine
                        </h1>
                        <p className="text-slate-400 mt-2">Instantly find your digital nomad visa options worldwide.</p>
                    </header>
                    
                    <div className="text-center my-8">
                        <button onClick={() => setLegalModalContent(legalContent.about)} className="inline-block bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            ð¡ About This Project
                        </button>
                    </div>
                    
                    <div className="bg-slate-800 shadow-2xl rounded-xl p-6 mb-8 max-w-6xl mx-auto">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            <div className="space-y-6">
                                <div>
                                    <label htmlFor="nationality" className="block text-sm font-medium text-slate-300 mb-2">ð Your Citizenship Region</label>
                                    <select id="nationality" value={selectedRegion} onChange={(e) => setSelectedRegion(e.target.value)}
                                        className="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white">
                                        <option value="">-- Select Region --</option>
                                        {citizenshipRegions.map(region => <option key={region.value} value={region.value}>{region.label}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-slate-300 mb-2">ð° Est. Monthly Income (USD)</label>
                                    <div className="flex flex-wrap gap-2">
                                        {incomeLevels.map(level => (
                                            <button key={level.value} onClick={() => setSelectedIncomeValue(level.value)}
                                                className={`px-3 py-2 text-sm rounded-md transition-all ${selectedIncomeValue === level.value ? 'bg-purple-600 text-white shadow-lg ring-2 ring-purple-400' : 'bg-slate-700 hover:bg-slate-600 text-slate-300'}`}>
                                                {level.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-6 bg-slate-900/50 p-4 rounded-lg">
                                <h3 className="text-lg font-semibold text-purple-400">Advanced Filters</h3>
                                <div className="space-y-4">
                                    <div className="text-sm">
                                        <label htmlFor="cost-slider" className="flex justify-between font-medium text-slate-300 mb-1"><span>ð¸ Max Visa Cost</span><span>${maxVisaCost}</span></label>
                                        <input id="cost-slider" type="range" min="0" max="3000" step="50" value={maxVisaCost} onChange={e => setMaxVisaCost(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                    <div className="text-sm">
                                        <label htmlFor="tax-slider" className="flex justify-between font-medium text-slate-300 mb-1"><span>ð Min Tax Attractiveness</span><span>{minTaxAttractiveness}/5</span></label>
                                        <input id="tax-slider" type="range" min="1" max="5" step="1" value={minTaxAttractiveness} onChange={e => setMinTaxAttractiveness(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                    <div className="text-sm">
                                        <label htmlFor="length-slider" className="flex justify-between font-medium text-slate-300 mb-1"><span>â³ Min Visa Length</span><span>{minVisaLength} months</span></label>
                                        <input id="length-slider" type="range" min="1" max="36" step="1" value={minVisaLength} onChange={e => setMinVisaLength(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <main className="mt-8 max-w-7xl mx-auto">
                        {selectedRegion ? (filteredVisas.length > 0 ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredVisas.map((visa, index) => (
                                    <VisaCard key={`${visa.country}-${visa.visa_name}-${index}`} visa={visa} onViewDetails={() => setModalContent(visa)} />
                                ))}
                            </div>
                        ) : <p className="text-center text-slate-400 py-10">No visas match your current criteria.</p>) : <p className="text-center text-slate-400 py-10 text-lg">Please select your citizenship region to begin.</p>}
                    </main>
                    
                    {modalContent && <DetailsModal visa={modalContent} onClose={() => setModalContent(null)} onOpenWalkthrough={openWalkthrough} />}
                    {legalModalContent && <LegalModal data={legalModalContent} onClose={() => setLegalModalContent(null)} />}
                    {walkthroughContent && <WalkthroughModal data={walkthroughContent} onClose={() => setWalkthroughContent(null)} />}
                    {showBanner && <CookieBanner onAccept={handleConsent} />}

                    <footer className="text-center mt-12 py-4 border-t border-slate-700">
                        <div className="text-sm text-slate-400 space-x-4">
                            <a href="#" onClick={(e) => {e.preventDefault(); setLegalModalContent(legalContent.terms)}} className="hover:text-white underline">Terms of Use</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setLegalModalContent(legalContent.privacy)}} className="hover:text-white underline">Privacy Policy</a>
                        </div>
                        <p className="text-xs text-slate-500 mt-2">Always verify information with official sources.</p>
                    </footer>
                </div>
            );
        }
        
        function CookieBanner({ onAccept }) {
             return (
                <div className="fixed bottom-0 left-0 right-0 bg-slate-900/80 backdrop-blur-sm p-4 border-t border-slate-700 z-50">
                    <div className="max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
                        <p className="text-sm text-slate-300">This site uses cookies for analytics to improve your experience.</p>
                        <button onClick={onAccept} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg whitespace-nowrap">Accept</button>
                    </div>
                </div>
            );
        }

        function LegalModal({ data, onClose }) {
             return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center pb-4 border-b border-slate-700">
                            <h2 className="text-2xl font-bold text-purple-400">{data.title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light">&times;</button>
                        </div>
                        <div className="mt-6 text-slate-300 text-sm space-y-4 leading-relaxed">
                            {data.imageSrc && (
                                <div className="text-center mb-6">
                                    <img src={data.imageSrc} alt="Project Founder Yonatan" className="w-48 h-48 mx-auto rounded-full object-cover border-4 border-purple-400 shadow-lg"/>
                                    <p className="text-xs text-slate-400 mt-2 italic">{data.imageCaption}</p>
                                </div>
                            )}
                            {data.story && data.story.split('\n').map((p, i) => <p key={i}>{p}</p>)}
                            {data.disclaimer && <p className="mt-4 text-sm text-yellow-400 bg-yellow-900/50 p-3 rounded-lg">{data.disclaimer}</p>}
                            {data.closing && <p className="mt-4 italic">{data.closing}</p>}
                            {data.content && data.content.split('\n').map((p, i) => <p key={i}>{p}</p>)}
                        </div>
                    </div>
                </div>
            );
        }

        function VisaCard({ visa, onViewDetails }) {
            const bureaucracyAttrs = getScoreAttributes(visa.bureaucracy_level, 'bureaucracy');
            return (
                <div className="bg-slate-800 shadow-xl rounded-lg p-5 flex flex-col justify-between transition-all hover:shadow-purple-500/30 hover:scale-[1.02] duration-300">
                    <div>
                        <h3 className="text-xl font-bold text-purple-400 mb-2">
                            {getCountryFlagEmoji(visa.country)} {visa.country} â <span className="font-normal text-slate-300">{visa.visa_name}</span>
                        </h3>
                        <div className="space-y-3 text-sm mb-4">
                            <p>â³<span className="font-semibold"> Duration:</span> {visa.visa_length_months ? `${visa.visa_length_months} months` : 'N/A'}</p>
                            <p>ð¸<span className="font-semibold"> Visa Cost:</span> {visa.visa_cost_usd !== null ? `~$${visa.visa_cost_usd}` : 'N/A'}</p>
                            <p className="flex items-center">
                                <span className="font-semibold mr-2">ð¤¯ Bureaucracy:</span>
                                <span className="font-bold" style={{color: bureaucracyAttrs.color}}>{bureaucracyAttrs.description}</span>
                            </p>
                        </div>
                    </div>
                    <div className="mt-auto text-center">
                         <a href={visa.source_url || '#'} target="_blank" rel="noopener noreferrer" className="inline-block bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 text-xs font-semibold py-1 px-3 rounded-full transition-colors mb-4" title={visa.source_url || 'Source not available'}>
                            Last Checked: June 16, 2025
                        </a>
                        <button className="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition" onClick={onViewDetails}>
                            View Full Details
                        </button>
                    </div>
                </div>
            );
        }

        const ScoreBar = ({ score, label, emoji, type = 'standard' }) => {
            const { description, color, percentage } = getScoreAttributes(score, type);
            return (
                <div className="w-full relative group">
                    <div className="flex justify-between items-center mb-1 text-sm">
                        <span className="font-medium text-slate-300">{emoji} {label}</span>
                        <span className="font-bold" style={{color: color}}>{description}</span>
                    </div>
                    <div className="w-full bg-slate-700 rounded-full h-2.5">
                        <div className="h-2.5 rounded-full" style={{ width: `${percentage}%`, backgroundColor: color }}></div>
                    </div>
                    {type === 'ssn_attractiveness' && (
                        <div className="absolute bottom-full left-0 w-max max-w-xs mb-2 hidden group-hover:block bg-slate-900 text-white text-xs rounded-lg py-2 px-3 z-10 border border-slate-700 shadow-lg">
                           Score based on mandatory social security payments. Higher is better (lower payments).
                        </div>
                    )}
                </div>
            );
        };

        const DetailText = ({ label, value }) => (
            <div className="relative group text-sm">
                 <p className="text-slate-300 truncate">
                    <strong className="text-slate-400">{label}:</strong> {value || 'N/A'}
                </p>
                <div className="absolute bottom-full left-0 w-max max-w-xs mb-2 hidden group-hover:block bg-slate-900 text-white text-xs rounded-lg py-2 px-3 z-10 border border-slate-700 shadow-lg">
                    {value || 'N/A'}
                </div>
            </div>
        );

        function DetailsModal({ visa, onClose, onOpenWalkthrough }) {
            const hasWalkthrough = ['Spain', 'Portugal', 'Thailand'].includes(visa.country);
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start pb-4 border-b border-slate-700">
                           <div className="flex-grow">
                                <h2 className="text-2xl font-bold text-purple-400 flex flex-wrap items-center gap-4">
                                    <span>{getCountryFlagEmoji(visa.country)} {visa.country}</span>
                                </h2>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light ml-4">&times;</button>
                        </div>
                        {hasWalkthrough && (
                            <div className="text-center my-6">
                                <button onClick={() => onOpenWalkthrough(visa.country)} className="w-full font-bold bg-amber-500 text-slate-900 px-4 py-2 rounded-lg hover:bg-amber-400 transition-colors shadow-lg transform hover:scale-105">
                                    ð View User Experiences & Application Guide ð
                                </button>
                            </div>
                        )}
                        <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-6">
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-3">ð Key Information</h3>
                                    <div className="space-y-2 text-sm text-slate-300">
                                        <p><strong className="text-slate-400">Visa Name:</strong> {visa.visa_name}</p>
                                        <p><strong className="text-slate-400">Duration:</strong> {visa.visa_length_months ? `${visa.visa_length_months} months` : 'N/A'}</p>
                                        <p><strong className="text-slate-400">Cost (est.):</strong> {visa.visa_cost_usd !== null ? `~$${visa.visa_cost_usd}` : 'N/A'}</p>
                                        <p><strong className="text-slate-400">Apply Remotely:</strong> {visa.can_you_apply_remotely}</p>
                                    </div>
                                </div>
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-3">â Requirements</h3>
                                    <div className="space-y-2 text-sm text-slate-300">
                                        <p><strong className="text-slate-400">Min. Income:</strong> {visa.income_requirements_monthly_usd ? `$${visa.income_requirements_monthly_usd.toLocaleString()}/mo` : 'Not Specified'}</p>
                                        <p><strong className="text-slate-400">Eligible Citizens:</strong> {visa.category_citizenship.join(', ')}</p>
                                    </div>
                                </div>
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-3">â­ Bonuses & Incentives</h3>
                                    <p className="text-sm text-slate-300">{visa.bonuses_incentives}</p>
                                </div>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-4">ð Attractiveness Scores (1-5)</h3>
                                    <div className="space-y-4">
                                        <ScoreBar score={visa.cost_of_living_attractiveness} label="Cost of Living" emoji="ð°" type="cost_of_living" />
                                        <ScoreBar score={visa.tax_attractiveness} label="Tax Attractiveness" emoji="ð¸"/>
                                        <ScoreBar score={visa.ssn_attractiveness} label="SSN Attractiveness" emoji="ð¤" type="ssn_attractiveness" />
                                        <ScoreBar score={visa.bureaucracy_level} label="Bureaucracy" emoji="ð¤¯" type="bureaucracy" />
                                    </div>
                                </div>
                                {visa.remarks && (
                                    <div className="bg-slate-900/50 p-4 rounded-lg">
                                        <h3 className="text-lg font-semibold text-slate-200 mb-2">ð Remarks</h3>
                                        <p className="text-sm text-slate-300">{visa.remarks}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        function WalkthroughModal({ data, onClose }) {
            const [step, setStep] = React.useState(0);
            const currentStep = data.steps[step];

            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center pb-4 border-b border-slate-700">
                            <h2 className="text-xl md:text-2xl font-bold text-amber-400">{data.title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light">&times;</button>
                        </div>

                        <div className="my-4 text-center">
                            <p className="text-sm text-slate-400">Step {step + 1} of {data.steps.length}</p>
                            <div className="w-full bg-slate-700 rounded-full h-1.5 mt-1">
                                <div className="bg-amber-500 h-1.5 rounded-full" style={{ width: `${((step + 1) / data.steps.length) * 100}%` }}></div>
                            </div>
                        </div>

                        <div className="mt-6 space-y-4">
                            <h3 className="text-lg font-bold text-slate-100">{currentStep.title}</h3>
                            <div className="bg-slate-900/50 p-4 rounded-lg">
                                <h4 className="font-semibold text-purple-400 mb-2">Official Info</h4>
                                <p className="text-sm text-slate-300">{currentStep.officialInfo}</p>
                            </div>
                             <div className="bg-slate-900/50 p-4 rounded-lg">
                                <h4 className="font-semibold text-amber-400 mb-2">ð¡ User Insights</h4>
                                {currentStep.insights.map((insight, index) => (
                                    <div key={index} className="text-sm text-slate-300 border-l-2 border-amber-500 pl-3 mb-2">
                                        <p>"{insight.text}"</p>
                                        <p className="text-xs text-slate-500 mt-1">- {insight.metric}</p>
                                    </div>
                                ))}
                            </div>
                             {currentStep.links && currentStep.links.length > 0 && (
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h4 className="font-semibold text-sky-400 mb-2">Helpful Links</h4>
                                    <div className="flex flex-col sm:flex-row gap-2">
                                        {currentStep.links.map((link, index) => (
                                            <a key={index} href={link.url} target="_blank" rel="noopener noreferrer" className="text-sm bg-sky-600 hover:bg-sky-500 text-white font-semibold py-2 px-3 rounded-lg text-center transition-colors">
                                                {link.label}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="mt-8 flex justify-between items-center">
                            <button onClick={() => setStep(step - 1)} disabled={step === 0} className="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                                Back
                            </button>
                             <div className="text-xs text-center text-slate-400 bg-slate-900/50 p-2 rounded-lg">
                                Alpha Testers Feature
                            </div>
                            <button onClick={() => { if (step < data.steps.length - 1) setStep(step + 1); else onClose(); }} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                                {step === data.steps.length - 1 ? 'Finish' : 'Next'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
