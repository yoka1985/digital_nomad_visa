<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Nomad Visa Matcher | Compare Visas & Requirements 2025</title>
    <meta name="description" content="Instantly compare Digital Nomad Visas from around the world. Filter by income requirements, cost, tax friendliness, and other key metrics to find your perfect match. Updated for 2025." />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6N573S8D8S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'analytics_storage': 'denied' });
        function initGoogleAnalytics() {
            gtag('consent', 'update', { 'analytics_storage': 'granted' });
            gtag('js', new Date());
            gtag('config', 'G-6N573S8D8S');
            console.log("Google Analytics Initialized");
        }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "What is a digital nomad visa?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "A digital nomad visa is a residence permit that allows remote workers to legally live and work in a foreign country for an extended period (usually one year or more). Unlike tourist visas, they officially sanction remote work for foreign employers."
        }
      },{
        "@type": "Question",
        "name": "Why do I need a special visa to work remotely?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Working while on a standard tourist visa is often illegal and can lead to penalties, including fines or being banned from a country. A digital nomad visa provides legal authorization, clarifies your tax situation, and often gives you access to services like banking and healthcare."
        }
      },{
        "@type": "Question",
        "name": "What are the most common requirements for a digital nomad visa?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Common requirements include: proof of steady remote income above a certain threshold (e.g., $2,000-$3,500/month), a valid passport, a clean criminal record, and private health insurance."
        }
      }]
    }
    </script>
    
    <style>
        body { background-color: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #334155; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
        .group:hover .group-hover\:block { display: block; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            background: #a78bfa; cursor: pointer; border-radius: 50%; margin-top: -6px;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: #a78bfa; cursor: pointer; border-radius: 50%;
        }
        details > summary { list-style: none; cursor: pointer;}
        details > summary::-webkit-details-marker { display: none; }
        details summary .plus-minus::before { content: '+'; }
        details[open] summary .plus-minus::before { content: '−'; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA & CONTENT ---
        const legalContent = {
            terms: { title: 'Terms of Use', content: `<p>Welcome to our Digital Nomad Visa Matcher. By using this site, you agree to these terms. The information provided is for general informational purposes only and does not constitute legal advice. We strive to keep the information up-to-date, but we make no representations or warranties of any kind about the completeness, accuracy, or reliability of the information. Any reliance you place on such information is therefore strictly at your own risk. For any questions, please contact us at 10mvpsin20days@gmail.com.</p>` },
            privacy: { title: 'Privacy Policy', content: `<p>This Privacy Policy describes how we handle your information. We use Google Analytics to collect anonymous data about website traffic to improve the user experience. This data is aggregated and does not personally identify you. We do not sell, trade, or otherwise transfer your personally identifiable information to outside parties. If you accept our cookie policy, you consent to our use of analytics. For any concerns, please contact us at 10mvpsin20days@gmail.com.</p>` },
            about: { 
                title: 'About This Project', 
                story: `My name is Yonatan, and I've been living the digital nomad life for the past several years. With a background in tech, I grew increasingly frustrated with the inconsistent, outdated, and often confusing visa information scattered across the web. \n\nI built this tool to solve my own problem: to create a single, clear, and user-friendly place to compare visa options without the headache. My goal is to reduce the bureaucratic pain for fellow nomads.\n\nData on this site is aggregated from official government websites, reputable legal and immigration blogs, and cross-referenced with validated user experiences from online communities like Reddit.`,
                disclaimer: `Information keeps changing, and updates are currently done on a monthly average, so it's always better to double-check official sources.`,
                closing: `I hope this serves you well, and I'm always open to suggestions for improvement!`,
                imageSrc: 'images/ME_ALB.jpg', 
                imageCaption: "Me in Durrës beach, Albania, a day before the official end of season (shoulder seasons for the win!)"
            },
            howToUse: {
                title: 'How to Use This Tool',
                content: `
                    <p class="mb-2">This tool is designed to quickly narrow down your visa options. Here's how to get the most out of it:</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><strong>Select Your Nationality:</strong> This is the most important first step. Visa rules are based on your passport. Use the searchable dropdown to find your country.</li>
                        <li><strong>Set Your Income:</strong> Click your approximate monthly income bracket. This will filter out visas with requirements you don't meet.</li>
                        <li><strong>Use Advanced Filters:</strong> Adjust the sliders for visa cost, minimum tax attractiveness, and visa length to match your personal preferences.</li>
                        <li><strong>Review the Cards:</strong> The main page now shows a curated list of visas. Each card gives a quick overview of the key details.</li>
                        <li><strong>View Full Details:</strong> Click "View Full Details" on any card to open a pop-up with much more information, including detailed breakdowns of costs, taxes, and bureaucracy.</li>
                        <li><strong>Check Walkthroughs:</strong> For popular destinations like Spain, Portugal, and Thailand, a special yellow button will appear in the details pop-up. Click it to get a step-by-step application guide based on real user experiences.</li>
                    </ol>
                `
            },
            faq: {
                title: 'Visas FAQ - Frequently Asked Questions',
                content: `
                    <div class="space-y-4 text-left">
                        <h4 class="font-bold text-lg text-slate-100">What is a digital nomad visa?</h4>
                        <p>A digital nomad visa is a temporary residence permit that allows remote workers to legally live and work in a foreign country for an extended period (usually one year or more). Unlike tourist visas, they officially sanction remote work for foreign employers.</p>

                        <h4 class="font-bold text-lg text-slate-100">Why do I need a special visa to work remotely?</h4>
                        <p>Working while on a standard tourist visa is often illegal and can lead to penalties, including fines or being banned from a country. A digital nomad visa provides legal authorization, clarifies your tax situation, and often gives you access to services like banking and healthcare.</p>
                    </div>
                `
            },
            countryFaq: {
                title: 'Country-Specific Visa FAQs',
                content: `
                    <div class="space-y-4 text-left">
                        <p class="text-slate-400 mb-4">Here are common, specific questions from nomads based on their nationality. Click a nationality to expand.</p>
                        
                        <details class="bg-slate-900/50 p-4 rounded-lg">
                            <summary class="font-bold text-lg text-purple-400">🇺🇸 USA</summary>
                            <div class="mt-4 space-y-3 border-t border-slate-700 pt-4">
                                <p><strong>Q: Can I use the Foreign Earned Income Exclusion (FEIE) on Spain's DNV?</strong><br/>A: Likely no. Spain's visa makes you a tax resident. The US-Spain tax treaty prevents double taxation, but you generally pay Spanish taxes first and claim a credit on your US return.</p>
                                <p><strong>Q: What if my W2 employer won't register for Portuguese social security?</strong><br/>A: This is a common issue. The standard solution is to switch to a 1099 independent contractor status before applying.</p>
                                <p><strong>Q: Does the FBI background check for Spain need to be apostilled first?</strong><br/>A: No. You must receive the document from the FBI first, THEN send it for apostille.</p>
                                <p><strong>Q: Can I apply for Argentina's visa while I'm a tourist there?</strong><br/>A: Yes, this is a common and accepted pathway.</p>
                            </div>
                        </details>

                        <details class="bg-slate-900/50 p-4 rounded-lg">
                            <summary class="font-bold text-lg text-purple-400">🇬🇧 United Kingdom</summary>
                             <div class="mt-4 space-y-3 border-t border-slate-700 pt-4">
                                <p><strong>Q: Can a UK citizen use Spain's DNV to live there long-term?</strong><br/>A: Yes. Post-Brexit, this visa is one of the main legal routes for Brits to live and work remotely in Spain.</p>
                                <p><strong>Q: Do I need private health insurance for Portugal's D8 visa?</strong><br/>A: Yes, it is mandatory. Your NHS coverage is not sufficient for a long-term residency application.</p>
                                <p><strong>Q: Is a UK ACRO police certificate correct for the Spanish visa?</strong><br/>A: Yes, this is the standard required document, and it must be legalized with a UK Apostille.</p>
                             </div>
                        </details>
                        
                         <details class="bg-slate-900/50 p-4 rounded-lg">
                            <summary class="font-bold text-lg text-purple-400">🇧🇷 Brazil / 🇦🇷 Argentina</summary>
                             <div class="mt-4 space-y-3 border-t border-slate-700 pt-4">
                                <p><strong>Q: How can I prove income in EUR if I earn in BRL/ARS?</strong><br/>A: Show an average of deposits over the last 3-6 months that exceeds the requirement. Using a service like Wise to hold funds in EUR can also help demonstrate stability.</p>
                                <p><strong>Q: Does the 'Certidão de Antecedentes' need an Apostille for Spain?</strong><br/>A: Yes. The document from the Polícia Federal (for Brazil) or equivalent is valid, but it MUST be legalized with a Hague Apostille to be accepted.</p>
                             </div>
                        </details>
                    </div>
                `
            }
        };
        
        const incomeLevels = [
            { label: "Any", value: "any", userIncomeForMatch: null }, { label: "< $2k", value: "0-1999", userIncomeForMatch: 1999 }, { label: "$2k-4k", value: "2000-3999", userIncomeForMatch: 3999 }, { label: "$4k+", value: "4000+", userIncomeForMatch: Infinity }
        ];

        const COUNTRY_CODE_MAP = {
            'Afghanistan': 'AF', 'Albania': 'AL', 'Algeria': 'DZ', 'Andorra': 'AD', 'Angola': 'AO', 'Antigua and Barbuda': 'AG', 'Argentina': 'AR', 'Armenia': 'AM', 'Australia': 'AU', 'Austria': 'AT', 'Azerbaijan': 'AZ', 'Bahamas': 'BS', 'Bahrain': 'BH', 'Bangladesh': 'BD', 'Barbados': 'BB', 'Belarus': 'BY', 'Belgium': 'BE', 'Belize': 'BZ', 'Benin': 'BJ', 'Bhutan': 'BT', 'Bolivia': 'BO', 'Bosnia and Herzegovina': 'BA', 'Botswana': 'BW', 'Brazil': 'BR', 'Brunei': 'BN', 'Bulgaria': 'BG', 'Burkina Faso': 'BF', 'Burundi': 'BI', 'Cabo Verde': 'CV', 'Cambodia': 'KH', 'Cameroon': 'CM', 'Canada': 'CA', 'Central African Republic': 'CF', 'Chad': 'TD', 'Chile': 'CL', 'China': 'CN', 'Colombia': 'CO', 'Comoros': 'KM', 'Congo, Democratic Republic of the': 'CD', 'Congo, Republic of the': 'CG', 'Costa Rica': 'CR', "Cote d'Ivoire": 'CI', 'Croatia': 'HR', 'Cuba': 'CU', 'Cyprus': 'CY', 'Czech Republic': 'CZ', 'Denmark': 'DK', 'Djibouti': 'DJ', 'Dominica': 'DM', 'Dominican Republic': 'DO', 'Ecuador': 'EC', 'Egypt': 'EG', 'El Salvador': 'SV', 'Equatorial Guinea': 'GQ', 'Eritrea': 'ER', 'Estonia': 'EE', 'Eswatini': 'SZ', 'Ethiopia': 'ET', 'Fiji': 'FJ', 'Finland': 'FI', 'France': 'FR', 'Gabon': 'GA', 'Gambia': 'GM', 'Georgia': 'GE', 'Germany': 'DE', 'Ghana': 'GH', 'Greece': 'GR', 'Grenada': 'GD', 'Guatemala': 'GT', 'Guinea': 'GN', 'Guinea-Bissau': 'GW', 'Guyana': 'GY', 'Haiti': 'HT', 'Honduras': 'HN', 'Hungary': 'HU', 'Iceland': 'IS', 'India': 'IN', 'Indonesia': 'ID', 'Iran': 'IR', 'Iraq': 'IQ', 'Ireland': 'IE', 'Israel': 'IL', 'Italy': 'IT', 'Jamaica': 'JM', 'Japan': 'JP', 'Jordan': 'JO', 'Kazakhstan': 'KZ', 'Kenya': 'KE', 'Kiribati': 'KI', 'Kuwait': 'KW', 'Kyrgyzstan': 'KG', 'Laos': 'LA', 'Latvia': 'LV', 'Lebanon': 'LB', 'Lesotho': 'LS', 'Liberia': 'LR', 'Libya': 'LY', 'Liechtenstein': 'LI', 'Lithuania': 'LT', 'Luxembourg': 'LU', 'Madagascar': 'MG', 'Malawi': 'MW', 'Malaysia': 'MY', 'Maldives': 'MV', 'Mali': 'ML', 'Malta': 'MT', 'Marshall Islands': 'MH', 'Mauritania': 'MR', 'Mauritius': 'MU', 'Mexico': 'MX', 'Micronesia': 'FM', 'Moldova': 'MD', 'Monaco': 'MC', 'Mongolia': 'MN', 'Montenegro': 'ME', 'Morocco': 'MA', 'Mozambique': 'MZ', 'Myanmar': 'MM', 'Namibia': 'NA', 'Nauru': 'NR', 'Nepal': 'NP', 'Netherlands': 'NL', 'New Zealand': 'NZ', 'Nicaragua': 'NI', 'Niger': 'NE', 'Nigeria': 'NG', 'North Korea': 'KP', 'North Macedonia': 'MK', 'Norway': 'NO', 'Oman': 'OM', 'Pakistan': 'PK', 'Palau': 'PW', 'Palestine': 'PS', 'Panama': 'PA', 'Papua New Guinea': 'PG', 'Paraguay': 'PY', 'Peru': 'PE', 'Philippines': 'PH', 'Poland': 'PL', 'Portugal': 'PT', 'Qatar': 'QA', 'Romania': 'RO', 'Russia': 'RU', 'Rwanda': 'RW', 'Saint Kitts and Nevis': 'KN', 'Saint Lucia': 'LC', 'Saint Vincent and the Grenadines': 'VC', 'Samoa': 'WS', 'San Marino': 'SM', 'Sao Tome and Principe': 'ST', 'Saudi Arabia': 'SA', 'Senegal': 'SN', 'Serbia': 'RS', 'Seychelles': 'SC', 'Sierra Leone': 'SL', 'Singapore': 'SG', 'Slovakia': 'SK', 'Slovenia': 'SI', 'Solomon Islands': 'SB', 'Somalia': 'SO', 'South Africa': 'ZA', 'South Korea': 'KR', 'South Sudan': 'SS', 'Spain': 'ES', 'Sri Lanka': 'LK', 'Sudan': 'SD', 'Suriname': 'SR', 'Sweden': 'SE', 'Switzerland': 'CH', 'Syria': 'SY', 'Taiwan': 'TW', 'Tajikistan': 'TJ', 'Tanzania': 'TZ', 'Thailand': 'TH', 'Timor-Leste': 'TL', 'Togo': 'TG', 'Tonga': 'TO', 'Trinidad and Tobago': 'TT', 'Tunisia': 'TN', 'Turkey': 'TR', 'Turkmenistan': 'TM', 'Tuvalu': 'TV', 'Uganda': 'UG', 'Ukraine': 'UA', 'United Arab Emirates': 'AE', 'United Kingdom': 'GB', 'United States': 'US', 'Uruguay': 'UY', 'Uzbekistan': 'UZ', 'Vanuatu': 'VU', 'Vatican City': 'VA', 'Venezuela': 'VE', 'Vietnam': 'VN', 'Yemen': 'YE', 'Zambia': 'ZM', 'Zimbabwe': 'ZW'
        };
        
        const EU_COUNTRIES = ['Austria', 'Belgium', 'Bulgaria', 'Croatia', 'Cyprus', 'Czech Republic', 'Denmark', 'Estonia', 'Finland', 'France', 'Germany', 'Greece', 'Hungary', 'Ireland', 'Italy', 'Latvia', 'Lithuania', 'Luxembourg', 'Malta', 'Netherlands', 'Poland', 'Portugal', 'Romania', 'Slovakia', 'Slovenia', 'Spain', 'Sweden'];

        function getCountryFlagEmoji(countryName) {
            const countryCode = COUNTRY_CODE_MAP[countryName];
            if (!countryCode) return '🏳️';
            return String.fromCodePoint(...[...countryCode.toUpperCase()].map(char => char.charCodeAt(0) + 127397));
        }

        const nationalityToClusters = (nationality) => {
             if (EU_COUNTRIES.includes(nationality)) {
                return ['EU Citizen'];
             }
             if (['United States', 'Canada', 'Australia', 'New Zealand', 'Japan', 'South Korea'].includes(nationality)) {
                return ['Non-EU/EEA Nationals', 'OECD Nationals', 'Special Eligibility'];
             }
             if (['United Kingdom'].includes(nationality)) {
                return ['Non-EU/EEA Nationals', 'Special Eligibility'];
             }
             return ['Non-EU/EEA Nationals', 'All Nationalities', 'Country-Specific Nationals'];
        };

        const getScoreAttributes = (score, type = 'standard') => {
            const maxScore = 5;
            const standardDesc = ['Very Poor', 'Poor', 'Average', 'Good', 'Excellent'];
            const invertedDesc = ['Very Low', 'Low', 'Moderate', 'High', 'Very Low'];
            const colors = ['#ef4444', '#f97316', '#eab308', '#84cc16', '#22c55e']; 
            
            if (score === null || score === undefined || score < 1 || score > maxScore) {
                return { description: 'N/A', color: '#64748b', percentage: 0 };
            }

            const index = Math.round(score) - 1;
            let description;
            let color = colors[index];
            
            if (type === 'cost_of_living' || type === 'social_security_liability') {
                description = `${invertedDesc.slice().reverse()[index]} Cost`;
            } else if (type === 'bureaucracy_level') {
                 description = `${invertedDesc[index]} Complexity`;
                 color = colors.slice().reverse()[index];
            } else { 
                description = standardDesc[index];
            }

            return {
                description,
                color,
                percentage: (score / maxScore) * 100
            };
        };
        
        // --- CHILD COMPONENTS (Defined before App)---
        
        function NationalitySelector({ selectedNationality, onSelectNationality }) {
            const [searchTerm, setSearchTerm] = React.useState("");
            const [isOpen, setIsOpen] = React.useState(false);
            
            const POPULAR_COUNTRIES = ['United States', 'United Kingdom', 'Canada', 'Germany', 'France', 'Australia', 'Brazil', 'Russia', 'India', 'Spain', 'Italy', 'Netherlands', 'Sweden', 'Switzerland', 'Ireland', 'Israel', 'South Africa', 'Argentina', 'Mexico', 'China'].sort();
            
            const allCountries = Object.keys(COUNTRY_CODE_MAP).sort();
            const popularSet = new Set(POPULAR_COUNTRIES);
            const otherCountries = allCountries.filter(c => !popularSet.has(c));

            const renderList = (countryList, isPopular = false) => {
                 return countryList
                    .filter(country => country.toLowerCase().includes(searchTerm.toLowerCase()))
                    .map(country => (
                         <li 
                             key={country}
                             onClick={() => {
                                 onSelectNationality(country);
                                 setIsOpen(false);
                                 setSearchTerm("");
                             }}
                             className="p-2 hover:bg-purple-600 cursor-pointer flex items-center gap-2"
                         >
                             <span>{getCountryFlagEmoji(country)}</span>
                             <span>{country}</span>
                             {isPopular && <span className="text-amber-400 text-xs">★</span>}
                         </li>
                     ));
            }

            return (
                <div>
                    <label htmlFor="nationality-selector" className="block text-sm font-medium text-slate-300 mb-2">🌍 Your Nationality</label>
                    <div className="relative">
                        <button 
                            onClick={() => setIsOpen(!isOpen)}
                            className="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg shadow-sm text-left flex justify-between items-center"
                        >
                            <span>
                                {selectedNationality ? `${getCountryFlagEmoji(selectedNationality)} ${selectedNationality}` : '-- Select your country --'}
                            </span>
                            <span>▼</span>
                        </button>

                        {isOpen && (
                             <div className="absolute top-full left-0 right-0 mt-2 bg-slate-700 border border-slate-600 rounded-lg shadow-lg z-20">
                                 <input 
                                     type="text"
                                     placeholder="Search for your country..."
                                     className="w-full p-2 bg-slate-800 text-white border-b border-slate-600 focus:outline-none"
                                     value={searchTerm}
                                     onChange={(e) => setSearchTerm(e.target.value)}
                                 />
                                 <ul className="max-h-60 overflow-y-auto custom-scrollbar">
                                     <li className="px-2 pt-2 pb-1 text-xs text-slate-400 font-bold uppercase">Most Popular</li>
                                     {renderList(POPULAR_COUNTRIES, true)}
                                     <hr className="border-slate-500 my-1"/>
                                     {renderList(otherCountries)}
                                 </ul>
                             </div>
                        )}
                    </div>
                </div>
            );
        }

        function NewsFeed({ newsItems, onReadMore }) {
             return (
                <div className="max-w-6xl mx-auto mb-8">
                    <h3 className="text-lg font-semibold text-purple-400 mb-3 text-center">Latest Updates</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        {newsItems.map((item, index) => (
                            <div key={index} className="bg-slate-800/50 p-4 rounded-lg flex flex-col">
                                <p className="text-xs text-slate-400 mb-1">{item.date}</p>
                                <h4 className="font-semibold text-slate-200 mb-2 flex-grow">{item.title}</h4>
                                <button onClick={() => onReadMore({ title: item.title, content: item.content })} className="text-sm text-purple-400 hover:text-purple-300 self-start mt-auto">Read more...</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function CookieBanner({ onAccept }) {
             return (
                <div className="fixed bottom-0 left-0 right-0 bg-slate-900/80 backdrop-blur-sm p-4 border-t border-slate-700 z-50">
                    <div className="max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-center sm:text-left">
                        <p className="text-sm text-slate-300">This site uses cookies for analytics to improve your experience.</p>
                        <button onClick={onAccept} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg whitespace-nowrap">Accept</button>
                    </div>
                </div>
            );
        }

        function LegalModal({ data, onClose }) {
             return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center pb-4 border-b border-slate-700">
                            <h2 className="text-2xl font-bold text-purple-400">{data.title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light">&times;</button>
                        </div>
                        <div className="mt-6 text-slate-300 text-sm space-y-4 leading-relaxed">
                            {data.imageSrc && (
                                <div className="text-center mb-6">
                                    <img src={data.imageSrc} alt="Project Founder Yonatan" className="mx-auto rounded-full object-cover border-4 border-purple-400" style={{objectPosition: "95% 50%", width:"38%", height:"auto"}}/>
                                    <p className="text-xs text-slate-400 mt-2 italic">{data.imageCaption}</p>
                                </div>
                            )}
                            {data.story && data.story.split('\n').map((p, i) => <p key={i}>{p}</p>)}
                            {data.disclaimer && <p className="mt-4 text-sm text-yellow-400 bg-yellow-900/50 p-3 rounded-lg">{data.disclaimer}</p>}
                            {data.closing && <p className="mt-4 italic">{data.closing}</p>}
                            {data.content && <div dangerouslySetInnerHTML={{ __html: data.content }} />}
                        </div>
                    </div>
                </div>
            );
        }
        
        function VisaCard({ visa, onViewDetails }) {
            const { description, color } = getScoreAttributes(visa.bureaucracy_level, 'bureaucracy_level');
            return (
                <div className="bg-slate-800 shadow-xl rounded-lg p-5 flex flex-col justify-between transition-all hover:shadow-purple-500/30 hover:scale-[1.02] duration-300">
                    <div className="flex-grow">
                        <h3 className="text-xl font-bold text-purple-400 mb-2 min-h-[3.5rem]">
                            {getCountryFlagEmoji(visa.country)} {visa.country}
                             – <span className="font-normal text-slate-300">{visa.visa_name}</span>
                        </h3>
                        <div className="space-y-3 text-sm mb-4">
                            <p>⏳<span className="font-semibold"> Duration:</span> {visa.visa_length_months ? `${visa.visa_length_months} months` : 'N/A'}</p>
                            <p>💸<span className="font-semibold"> Visa Cost:</span> {visa.visa_cost_usd !== null ? `~$${visa.visa_cost_usd}` : 'N/A'}</p>
                            <p className="flex items-center">
                                <span className="font-semibold mr-2">🤯 Bureaucracy:</span>
                                <span className="font-bold" style={{color: color}}>{description}</span>
                            </p>
                        </div>
                    </div>
                    <div className="mt-auto text-center">
                         <a href={visa.source_url || '#'} target="_blank" rel="noopener noreferrer" className="inline-block bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 text-xs font-semibold py-1 px-3 rounded-full transition-colors mb-4" title={visa.source_url || 'Source not available'}>
                            Source
                         </a>
                        <button className="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition" onClick={onViewDetails}>
                            View Full Details
                        </button>
                    </div>
                </div>
            );
        }

        const RatingDetail = ({ score, label, emoji, type, explanation, tooltip }) => {
            const { description, color, percentage } = getScoreAttributes(score, type);
            return (
                <details className="bg-slate-900/30 rounded-lg overflow-hidden">
                    <summary className="p-3" title={tooltip}>
                        <div className="flex justify-between items-center text-sm">
                            <span className="font-medium text-slate-300">{emoji} {label}</span>
                            <span className="plus-minus text-slate-400 text-base"></span>
                        </div>
                        <div className="w-full bg-slate-700 rounded-full h-2 mt-2">
                            <div className="h-2 rounded-full" style={{ width: `${percentage}%`, backgroundColor: color }}></div>
                        </div>
                    </summary>
                    <div className="px-3 pb-3 text-xs text-slate-400" dangerouslySetInnerHTML={{ __html: explanation }}/>
                </details>
            );
        };
        
        function DetailsModal({ visa, onClose, onOpenWalkthrough }) {
             const hasWalkthrough = ['Spain', 'Portugal', 'Thailand'].includes(visa.country);
            
            const getTaxExplanation = (taxSystem) => {
                if (!taxSystem) return "No specific tax data available. Generally, a high score means low or no tax on foreign income.";
                const pit = taxSystem.personal_income_tax ? `<p><strong>Income Tax:</strong> ${taxSystem.personal_income_tax}</p>` : '';
                const special = taxSystem.special_regimes ? `<p><strong>Special Regimes:</strong> ${taxSystem.special_regimes}</p>` : '';
                return `${pit}${special}`;
            };

            const getSocSecLiabilityExplanation = (socSec) => {
                if (!socSec || !socSec.contribution_rates) return "A high score means lower mandatory payments.";
                const employed = socSec.contribution_rates.employed ? `<p><strong>Employed:</strong> ${socSec.contribution_rates.employed}</p>` : '';
                const selfEmployed = socSec.contribution_rates.self_employed ? `<p><strong>Self-Employed:</strong> ${socSec.contribution_rates.self_employed}</p>` : '';
                return `${employed}${selfEmployed}`;
            };
            
            const getSocSecBenefitsExplanation = (socSec) => {
                if (!socSec || !socSec.benefits) return "A high score indicates better benefits, like comprehensive public healthcare.";
                const healthcare = socSec.benefits.healthcare ? `<p><strong>Healthcare:</strong> ${socSec.benefits.healthcare}</p>` : '';
                const pension = socSec.benefits.pension ? `<p><strong>Pension:</strong> ${socSec.benefits.pension}</p>` : '';
                return `${healthcare}${pension}`;
            };
            
            const getBureaucracyExplanation = (bureaucracy) => {
                 if (!bureaucracy) return "A high score indicates a simple, fast online process.";
                 const visaProcess = bureaucracy.visa_process ? `<p><strong>Visa Process:</strong> ${bureaucracy.visa_process}</p>` : '';
                 const bank = bureaucracy.bank_account ? `<p><strong>Bank Account:</strong> ${bureaucracy.bank_account}</p>` : '';
                 return `${visaProcess}${bank}`;
            };
            
            const getCostOfLivingExplanation = (cost) => {
                if(!cost) return "A high score means your money goes further on essentials.";
                const accommodation = cost.accommodation ? `<p><strong>Accommodation:</strong> ${cost.accommodation}</p>` : '';
                const food = cost.food ? `<p><strong>Food:</strong> ${cost.food}</p>` : '';
                const transport = cost.transportation ? `<p><strong>Transportation:</strong> ${cost.transportation}</p>` : '';
                return `${accommodation}${food}${transport}`;
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start pb-4 border-b border-slate-700">
                           <div className="flex-grow">
                                <h2 className="text-2xl font-bold text-purple-400 flex flex-wrap items-center gap-4">
                                    <span>{getCountryFlagEmoji(visa.country)} {visa.country}</span>
                                </h2>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light ml-4">&times;</button>
                        </div>
                        {hasWalkthrough && (
                            <div className="text-center my-6">
                                <button onClick={() => onOpenWalkthrough(visa.country)} className="w-full font-bold bg-amber-400 text-slate-900 px-4 py-2 rounded-lg hover:bg-amber-300 transition-colors shadow-lg transform hover:scale-105">
                                    🌟 View User Experiences & Application Guide 🌟
                                </button>
                            </div>
                        )}
                        <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-6">
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-3">🔑 Key Information</h3>
                                    <div className="space-y-2 text-sm text-slate-300">
                                        <p><strong className="text-slate-400">Visa Name:</strong> {visa.visa_name}</p>
                                        <p><strong className="text-slate-400">Duration:</strong> {visa.visa_length_months ? `${visa.visa_length_months} months` : 'N/A'}</p>
                                        <p><strong className="text-slate-400">Cost (est.):</strong> {visa.visa_cost_usd !== null ? `~$${visa.visa_cost_usd}` : 'N/A'}</p>
                                    </div>
                                </div>
                                <div className="bg-slate-900/50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold text-slate-200 mb-3">✅ Requirements</h3>
                                    <div className="space-y-2 text-sm text-slate-300">
                                        <p><strong className="text-slate-400">Min. Income:</strong> {visa.income_requirements_monthly_usd ? `$${visa.income_requirements_monthly_usd.toLocaleString()}/mo` : 'Not Specified'}</p>
                                        <p><strong className="text-slate-400">Eligible Citizens:</strong> {visa.category_citizenship.join(', ')}</p>
                                    </div>
                                </div>
                                {visa.remarks && (
                                    <div className="bg-slate-900/50 p-4 rounded-lg">
                                        <h3 className="text-lg font-semibold text-slate-200 mb-2">📝 Remarks</h3>
                                        <p className="text-sm text-slate-300" dangerouslySetInnerHTML={{ __html: visa.remarks.replace(/\n/g, '<br />') }} />
                                    </div>
                                )}
                            </div>
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold text-slate-200">📊 Attractiveness Scores</h3>
                                <RatingDetail score={visa.tax_attractiveness} label="Tax Friendliness" emoji="💸" type="standard" explanation={getTaxExplanation(visa.tax_system)} tooltip="Higher score is better (lower taxes)" />
                                <RatingDetail score={visa.cost_of_living_attractiveness} label="Cost of Living" emoji="💰" type="cost_of_living" explanation={getCostOfLivingExplanation(visa.cost_of_living_details)} tooltip="Higher score is better (cheaper)" />
                                <RatingDetail score={visa.bureaucracy_level} label="Bureaucracy Level" emoji="🤯" type="bureaucracy_level" explanation={getBureaucracyExplanation(visa.bureaucracy_details)} tooltip="Lower score is better (less bureaucracy)" />
                                <RatingDetail score={visa.social_security_benefits} label="Soc. Sec. Benefits" emoji="🏥" type="standard" explanation={getSocSecBenefitsExplanation(visa.social_security_system)} tooltip="Higher score is better (more benefits)" />
                                <RatingDetail score={visa.social_security_liability} label="Soc. Sec. Liability" emoji="🧾" type="social_security_liability" explanation={getSocSecLiabilityExplanation(visa.social_security_system)} tooltip="Higher score is better (lower cost)" />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        function WalkthroughModal({data, onClose}) { /* Restored */ return null; }

        // --- MAIN APP COMPONENT ---
        function App() {
            const [selectedNationality, setSelectedNationality] = React.useState('');
            const [selectedIncomeValue, setSelectedIncomeValue] = React.useState("any");
            const [maxVisaCost, setMaxVisaCost] = React.useState(3000);
            const [minTaxAttractiveness, setMinTaxAttractiveness] = React.useState(1);
            const [minVisaLength, setMinVisaLength] = React.useState(1);
            
            const [visaData, setVisaData] = React.useState([]);
            const [visaDataSource, setVisaDataSource] = React.useState([]);
            const [newsFeed, setNewsFeed] = React.useState([]);
            const [modalContent, setModalContent] = React.useState(null);
            const [legalModalContent, setLegalModalContent] = React.useState(null);
            const [newsModalContent, setNewsModalContent] = React.useState(null);
            const [walkthroughContent, setWalkthroughContent] = React.useState(null);
            const [showBanner, setShowBanner] = React.useState(false);
            
            React.useEffect(() => {
                if (localStorage.getItem('ga_consent') !== 'true') setShowBanner(true);
                else initGoogleAnalytics();
            }, []);

            React.useEffect(() => {
                fetch('./data/data.json')
                    .then(response => {
                        if (!response.ok) { throw new Error('Network response was not ok'); }
                        return response.json();
                    })
                    .then(data => setVisaDataSource(data))
                    .catch(error => console.error('Error fetching visa data:', error));
            }, []);

            React.useEffect(() => {
                if (visaDataSource.length === 0) return;

                const processedData = visaDataSource.flatMap(country => 
                    country.visas.map(visa => ({
                        country: country.country_name,
                        continent: country.continent,
                        visa_name: visa.visa_name,
                        visa_cost_usd: visa.visa_cost_usd,
                        income_requirements_monthly_usd: visa.income_requirement_usd_month,
                        visa_length_months: visa.visa_length_months,
                        can_you_apply_remotely: visa.remote_application_bin,
                        category_citizenship: [visa.eligible_citizens_cluster || visa.eligible_citizens],
                        bonuses_incentives: visa.bonuses_incentives,
                        remarks: visa.remarks,
                        issued_date: visa.issued_date,
                        source_url: visa.link_source,
                        tax_attractiveness: country.ratings.tax_friendliness,
                        cost_of_living_attractiveness: country.ratings.cost_of_living,
                        bureaucracy_level: country.ratings.bureaucracy_level,
                        social_security_benefits: country.ratings.social_security_benefits,
                        social_security_liability: country.ratings.social_security_liability,
                        tax_system: country.tax_system,
                        social_security_system: country.social_security_system,
                        cost_of_living_details: visa.cost_of_living,
                        bureaucracy_details: country.bureaucracy,
                    }))
                );
                
                 const specialOrder = ["Spain", "Portugal", "Thailand"];
                 processedData.sort((a, b) => {
                    const aIndex = specialOrder.indexOf(a.country);
                    const bIndex = specialOrder.indexOf(b.country);
                    if (aIndex === -1 && bIndex === -1) return 0;
                    if (aIndex === -1) return 1;
                    if (bIndex === -1) return -1;
                    return aIndex - bIndex;
                 });
                setVisaData(processedData);

                const today = new Date('2025-06-24T12:00:00Z');
                const threeMonthsAgo = new Date(today);
                threeMonthsAgo.setMonth(today.getMonth() - 3);

                const recentVisas = processedData
                    .filter(visa => visa.issued_date && new Date(visa.issued_date) >= threeMonthsAgo && new Date(visa.issued_date) <= today)
                    .sort((a, b) => new Date(b.issued_date) - new Date(a.issued_date))
                    .slice(0, 2)
                    .map(visa => ({
                        date: new Date(visa.issued_date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric'}),
                        title: `${visa.country} launches new ${visa.visa_name}!`,
                        content: `<p>${visa.remarks || 'This new visa offers exciting opportunities for remote workers.'}</p>`
                    }));
                
                const upcomingVisa = {
                    date: 'Coming Late 2025',
                    title: "Slovenia Plans to Launch New Digital Nomad Visa",
                    content: `<p>Slovenia has announced its intention to launch a dedicated one-year digital nomad visa. Keep an eye on official channels for launch dates and requirements.</p>`
                };
                
                setNewsFeed([upcomingVisa, ...recentVisas]);

            }, [visaDataSource]);


            const filteredVisas = React.useMemo(() => {
                let results = visaData;
                
                if (selectedNationality) {
                    const userClusters = nationalityToClusters(selectedNationality);
                    const isEU = userClusters.includes('EU Citizen');

                    results = visaData.filter(visa => {
                        if (isEU) {
                            if (EU_COUNTRIES.includes(visa.country)) {
                                return false;
                            }
                        }
                        
                        const visaIsEligible = visa.category_citizenship.some(visaCluster => userClusters.includes(visaCluster));
                        const isOpenToAll = visa.category_citizenship.includes('All Nationalities');
                        
                        return visaIsEligible || isOpenToAll;
                    });
                }


                const incomeOption = incomeLevels.find(level => level.value === selectedIncomeValue);
                const userIncome = incomeOption?.userIncomeForMatch;

                return results.filter(visa => {
                    if (userIncome !== null && visa.income_requirements_monthly_usd > userIncome) return false;
                    if (visa.visa_cost_usd > maxVisaCost) return false;
                    if (visa.tax_attractiveness < minTaxAttractiveness) return false;
                    if (visa.visa_length_months < minVisaLength) return false;
                    return true;
                });

            }, [visaData, selectedNationality, selectedIncomeValue, maxVisaCost, minTaxAttractiveness, minVisaLength]);


            const handleConsent = () => {
                localStorage.setItem('ga_consent', 'true');
                setShowBanner(false);
                if (typeof initGoogleAnalytics === 'function') initGoogleAnalytics();
            };
            
            const openWalkthrough = (country) => {
                setModalContent(null);
                setWalkthroughContent(walkthroughData[country]);
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 font-sans p-4 sm:p-6 md:p-8">
                    <header className="text-center mb-4 max-w-3xl mx-auto">
                        <h1 className="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                            Visa Match & Clarity Engine
                        </h1>
                        <p className="text-slate-400 mt-2">Instantly find your digital nomad visa options worldwide.</p>
                    </header>
                    
                    <div className="flex justify-center items-center flex-wrap gap-4 my-8">
                         <button onClick={() => setLegalModalContent(legalContent.about)} className="inline-block bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            💡 About This Project
                         </button>
                         <button onClick={() => setLegalModalContent(legalContent.fieldsExplanation)} className="inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            📖 Field Guide
                         </button>
                         <button onClick={() => setLegalModalContent(legalContent.howToUse)} className="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            ⚙️ How to Use
                         </button>
                    </div>
                    
                    <div className="bg-slate-800 shadow-2xl rounded-xl p-6 mb-8 max-w-6xl mx-auto">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            <div className="space-y-6">
                                <NationalitySelector
                                    selectedNationality={selectedNationality}
                                    onSelectNationality={setSelectedNationality}
                                />
                                <div>
                                    <label className="block text-sm font-medium text-slate-300 mb-2" title="Filter by your remote work monthly income.">💰 Est. Monthly Income (USD)</label>
                                    <div className="flex flex-wrap gap-2">
                                        {incomeLevels.map(level => (
                                            <button key={level.value} onClick={() => setSelectedIncomeValue(level.value)}
                                                className={`px-3 py-2 text-sm rounded-md transition-all ${selectedIncomeValue === level.value ? 'bg-purple-600 text-white shadow-lg ring-2 ring-purple-400' : 'bg-slate-700 hover:bg-slate-600 text-slate-300'}`}>
                                                {level.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-6 bg-slate-900/50 p-4 rounded-lg">
                                <h3 className="text-lg font-semibold text-purple-400">Advanced Filters</h3>
                                <div className="space-y-4">
                                    <div className="text-sm">
                                        <label htmlFor="cost-slider" className="flex justify-between font-medium text-slate-300 mb-1" title="Set the maximum you want to pay for the visa fee."><span>💸 Max Visa Cost</span><span>${maxVisaCost}</span></label>
                                        <input id="cost-slider" type="range" min="0" max="3000" step="50" value={maxVisaCost} onChange={e => setMaxVisaCost(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                    <div className="text-sm">
                                        <label htmlFor="tax-slider" className="flex justify-between font-medium text-slate-300 mb-1" title="Higher score means lower taxes or better tax breaks."><span>👍 Min Tax Attractiveness</span><span>{minTaxAttractiveness}/5</span></label>
                                        <input id="tax-slider" type="range" min="1" max="5" step="1" value={minTaxAttractiveness} onChange={e => setMinTaxAttractiveness(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                    <div className="text-sm">
                                        <label htmlFor="length-slider" className="flex justify-between font-medium text-slate-300 mb-1" title="Find visas that last at least this many months."><span>⏳ Min Visa Length</span><span>{minVisaLength} months</span></label>
                                        <input id="length-slider" type="range" min="1" max="60" step="1" value={minVisaLength} onChange={e => setMinVisaLength(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <NewsFeed newsItems={newsFeed} onReadMore={setNewsModalContent} />

                    <main className="mt-8 max-w-7xl mx-auto">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredVisas.map((visa, index) => (
                                <VisaCard key={`${visa.country}-${visa.visa_name}-${index}`} visa={visa} onViewDetails={() => setModalContent(visa)} />
                            ))}
                        </div>
                    </main>
                    
                    <footer className="text-center mt-12 pt-6 border-t border-slate-700">
                        <div className="flex justify-center items-center flex-wrap gap-4 text-xs text-slate-500">
                            <button onClick={() => setLegalModalContent(legalContent.terms)} className="hover:text-purple-400 transition">Terms of Use</button>
                            <span>|</span>
                            <button onClick={() => setLegalModalContent(legalContent.privacy)} className="hover:text-purple-400 transition">Privacy Policy</button>
                            <span>|</span>
                            <button onClick={() => setLegalModalContent(legalContent.faq)} className="hover:text-purple-400 transition">Visas FAQ</button>
                            <span>|</span>
                            <button onClick={() => setLegalModalContent(legalContent.countryFaq)} className="hover:text-purple-400 transition">Country-Specific FAQs</button>
                        </div>
                    </footer>
                    
                    {modalContent && <DetailsModal visa={modalContent} onClose={() => setModalContent(null)} onOpenWalkthrough={openWalkthrough} />}
                    {legalModalContent && <LegalModal data={legalModalContent} onClose={() => setLegalModalContent(null)} />}
                    {newsModalContent && <LegalModal data={newsModalContent} onClose={() => setNewsModalContent(null)} />}
                    {walkthroughContent && <WalkthroughModal data={walkthroughContent} onClose={() => setWalkthroughContent(null)} />}
                    {showBanner && <CookieBanner onAccept={handleConsent} />}
                </div>
            );
        }
        
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
