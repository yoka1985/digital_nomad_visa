<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Nomad Compass</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e293b; /* Darker background */
            color: #e2e8f0;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background-color: #0f172a;
        }
        .blur-overlay {
            backdrop-filter: blur(8px);
        }
        .persona-card, .option-card {
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1-px rgba(0, 0, 0, 0.06);
            border: 2px solid transparent;
            background-color: #2d3748; /* Darker card background */
            color: #cbd5e0;
        }
        .persona-card:hover, .option-card:hover {
            transform: scale(1.05);
            border-color: #6366f1;
        }
        .persona-card.selected, .option-card.selected {
            border-color: #6366f1;
            background-color: #3b4252;
            color: #ffffff;
        }
        .chart-bar {
            width: 3px; /* Smaller bar width */
            background-color: #6366f1;
            border-radius: 2px;
            transition: height 0.5s ease-out;
            margin: 0 1px;
        }
        .formkit-form, .formkit-input, .formkit-submit {
            color: #1e293b !important;
        }
        #newsletter-modal .formkit-form .formkit-input {
            border-color: #e2e8f0 !important;
        }
        #newsletter-modal .formkit-form .formkit-submit {
            background-color: #6366f1 !important;
            color: #ffffff !important;
        }
        #newsletter-modal .formkit-form .formkit-header h2,
        #newsletter-modal .formkit-form .formkit-subheader p,
        #newsletter-modal .formkit-form a {
            color: #e2e8f0 !important;
        }
        .rank-badge {
            background-color: #6366f1;
            color: #e2e8f0;
            padding: 4px 10px;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 0.875rem; /* text-sm */
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Application Container -->
    <div id="app" class="bg-slate-800 text-slate-100 rounded-3xl shadow-2xl p-8 max-w-2xl w-full flex flex-col items-center text-center transition-all duration-500 ease-in-out">

        <!-- Welcome Screen -->
        <div id="persona-screen" class="space-y-6">
            <h1 class="text-3xl font-bold">The Nomad Compass</h1>
            <p class="text-slate-400 text-lg">Which of these describes you best?</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8">
                <!-- Persona Cards -->
                <div data-persona="newbie" class="persona-card rounded-2xl flex flex-col items-center p-6 text-center">
                    <span class="text-4xl">üéí</span>
                    <span class="mt-2 text-lg font-semibold">The Newbie Nomad</span>
                    <span class="text-sm text-slate-400 font-normal">Aspiring or new</span>
                </div>
                <div data-persona="experienced" class="persona-card rounded-2xl flex flex-col items-center p-6 text-center">
                    <span class="text-4xl">‚úàÔ∏è</span>
                    <span class="mt-2 text-lg font-semibold">The Experienced Nomad</span>
                    <span class="text-sm text-slate-400 font-normal">A veteran looking to optimize</span>
                </div>
                <div data-persona="slowmad" class="persona-card rounded-2xl flex flex-col items-center p-6 text-center">
                    <span class="text-4xl">üè°</span>
                    <span class="mt-2 text-lg font-semibold">The "Slowmad" Settler</span>
                    <span class="text-sm text-slate-400 font-normal">Seeking a long-term base</span>
                </div>
                <div data-persona="entrepreneur" class="persona-card rounded-2xl flex flex-col items-center p-6 text-center">
                    <span class="text-4xl">üíº</span>
                    <span class="mt-2 text-lg font-semibold">The Digital Entrepreneur</span>
                    <span class="text-sm text-slate-400 font-normal">Focused on business logistics</span>
                </div>
            </div>
        </div>

        <!-- Customization Screen -->
        <div id="customization-screen" class="hidden space-y-6">
            <h2 id="customization-title" class="text-3xl font-bold"></h2>
            <p id="customization-description" class="text-slate-400 text-lg"></p>
            <div id="customization-questions" class="space-y-6 mt-8">
                <!-- Customization questions will be injected here -->
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="hidden flex flex-col items-center justify-center space-y-4">
            <div class="spinner"></div>
            <p class="text-xl font-semibold text-indigo-400">Calculating your perfect destinations...</p>
        </div>

        <!-- Curated Destination View -->
        <div id="results-screen" class="hidden space-y-6 w-full">
            <h2 id="results-title" class="text-3xl font-bold"></h2>
            <p id="results-description" class="text-slate-400 text-lg">Here are your top 5 destinations. Unlock the full list by subscribing!</p>
            <div id="destination-list" class="space-y-6 mt-8">
                <!-- Destination cards will be injected here -->
            </div>
        </div>
        
        <!-- Detail Screen -->
        <div id="detail-screen" class="hidden space-y-6 w-full text-left">
            <button id="back-to-results-btn" class="flex items-center text-indigo-400 hover:text-indigo-200 font-semibold transition-colors duration-300 mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                Back to List
            </button>
            <div id="detail-content">
                <!-- Detailed content will be injected here -->
            </div>
        </div>

    </div>

    <!-- Newsletter Modal -->
    <div id="newsletter-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-slate-800 text-slate-100 rounded-3xl shadow-2xl p-4 max-w-lg w-full relative">
            <button onclick="hideNewsletterForm()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 font-bold text-2xl">&times;</button>
            <div class="w-full h-full overflow-y-auto">
                <!-- Newsletter Form HTML from the user -->
                <script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
                <form action="https://app.kit.com/forms/8378924/subscriptions" class="seva-form formkit-form" method="post" data-sv-form="8378924" data-uid="66362223a4" data-format="inline" data-version="5" data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;You‚Äôre on the list! I‚Äôll reach out when I‚Äôve got something worth sharing.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;analytics&quot;:{&quot;google&quot;:null,&quot;fathom&quot;:null,&quot;facebook&quot;:null,&quot;segment&quot;:null,&quot;pinterest&quot;:null,&quot;sparkloop&quot;:null,&quot;googletagmanager&quot;:null},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;powered_by&quot;:{&quot;show&quot;:true,&quot;url&quot;:&quot;https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:&quot;bottom_right&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;sticky_bar&quot;:{&quot;display_in&quot;:&quot;top&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15}},&quot;version&quot;:&quot;5&quot;}" min-width="400 500 600 700 800" style="background-color: rgb(45, 55, 72); border-radius: 0px;"><div data-style="image"><div data-element="column" class="formkit-column" style="background-color: rgb(31, 41, 55); height: 480px;"><div class="formkit-background" style="background-image: url(&quot;https://embed.filekitcdn.com/e/ft8DkvccuKYS4LoHkedJCS/d1H8NRRJc6hVwY5pYWFCgx&quot;); opacity: 0.15;"></div><div class="formkit-header" data-element="header" style="color: rgb(255, 255, 255); font-size: 18px; font-weight: 700;"><h2><strong>Stay One Step Ahead, Anywhere on Earth üåç</strong></h2></div><div class="formkit-subheader" data-element="subheader" style="color: rgb(255, 255, 255); font-size: 15px;"><p>AI-curated visa updates, expat intel, and real nomad stories delivered weekly</p><p>‚Äã</p></div></div><div data-element="column" class="formkit-column"><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" class="seva-fields formkit-fields"><div class="formkit-field"><input class="formkit-input" name="email_address" aria-label="Email Address" placeholder="Email Address" required="" type="email" style="color: rgb(77, 77, 77); border-color: rgb(227, 227, 227); border-radius: 0px; font-weight: 400;"></div><div class="formkit-field"><input class="formkit-input" aria-label="Any feedback on the site? (optional)" name="fields[feedback]" placeholder="Any feedback on the site? (optional)" type="text" style="color: rgb(77, 77, 77); border-color: rgb(227, 227, 227); border-radius: 0px; font-weight: 400;"></div><button data-element="submit" class="formkit-submit formkit-submit" style="color: rgb(255, 255, 255); background-color: rgb(51, 51, 51); border-radius: 0px; font-weight: 400;"><div class="formkit-spinner"><div></div><div></div><div></div></div><span class="">Keep Me in the Loop</span></button></div><div class="formkit-powered-by-convertkit-container"><a href="https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic" data-element="powered-by" class="formkit-powered-by-convertkit" data-variant="dark" target="_blank" rel="nofollow">Built with Kit</a></div></div></div></form>
            </div>
        </div>
    </div>


    <script>
        // Data source as a JSON constant
        const destinationData = [
            {
                name: "Lisbon",
                country: "Portugal",
                continent: "Europe",
                costMonthly: "‚Ç¨1,200",
                weather: {
                    "max 1 month": "Sunny and mild ‚òÄÔ∏è",
                    "1-3 months": "Warm and breezy üå¨Ô∏è",
                    "3+ months": "Pleasant, with a few rainy days üå¶Ô∏è"
                },
                internetSpeed: "200 Mbps",
                image_url: "https://placehold.co/600x400/3b4252/e2e8f0?text=Lisbon,+Portugal",
                newbie: {
                    costOfLiving: { rating: 3, context: "Based on discussions this month, newcomers find rent prices challenging but day-to-day costs manageable." },
                    internetReliability: { rating: 5, context: "Consensus is that fiber internet is widely available and highly reliable across all neighborhoods." },
                    safety: { rating: 4, context: "Recent feedback shows general safety is high, but common-sense precautions against pickpocketing are a must." },
                    budget: { rating: 3, context: "The budget is a moderate challenge for new nomads, according to last month's threads." },
                    environment: { rating: 4, context: "The city environment is a major draw, with posts highlighting the vibrant urban culture over beach life." }
                },
                experienced: {
                    taxFriendliness: { rating: 5, context: "The NHR tax scheme is the main topic, with most experienced nomads confirming its benefits." },
                    visaProcess: { rating: 5, context: "The new Digital Nomad Visa application process is frequently discussed and praised for being straightforward." },
                    infrastructure: { rating: 5, context: "Nomads consistently praise the modern infrastructure, especially the public transport and numerous co-working spaces." },
                    budget: { rating: 4, context: "Experienced nomads find the cost manageable, especially when leveraging local insights for savings." },
                    environment: { rating: 5, context: "A mix of city and coast offers the best of both worlds, a highlight in many recent reviews." }
                },
                slowmad: {
                    communityVibe: { rating: 5, context: "A very active and welcoming community with numerous meetups and social groups reported weekly." },
                    residencyEase: { rating: 5, context: "Feedback highlights the long-term residency options and helpful expat groups for guidance." },
                    healthcareQuality: { rating: 5, context: "Recent posts express high satisfaction with both public and private healthcare options." },
                    budget: { rating: 3, context: "Sustained living costs are a key point of discussion for long-term settlers, with mixed feedback on affordability." },
                    environment: { rating: 5, context: "The balance of city life and coastal access makes it an ideal spot for long-term stays." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 5, context: "Discussions consistently point to a strong startup ecosystem and a supportive community for new ventures." },
                    paymentGateways: { rating: 4, context: "Most report easy access to international payment services, though some niche services are less supported." },
                    startupScene: { rating: 5, context: "The startup scene is buzzing, with online forums full of events, pitch nights, and networking opportunities." },
                    budget: { rating: 4, context: "The cost of running a business is considered reasonable, with a strong ROI for many." },
                    environment: { rating: 5, context: "A great city to network and grow a business while enjoying a high quality of life." }
                },
                hotSecrets: "This month's hottest topic is a new freelance visa program. Community consensus is highly positive (4/5 stars) as it simplifies the legal process.",
                popularity: [4, 5, 5], // Scores for last 3 years
                detailedMetrics: {
                    nightlife: { rating: 4, context: "Vibrant nightlife with rooftop bars, Fado houses, and a thriving music scene." },
                    culturalEvents: { rating: 5, context: "A constant flow of festivals, concerts, and art exhibitions to keep you engaged." },
                    transportation: { rating: 4, context: "Efficient and affordable public transport including trams, metro, and buses." },
                    weather: { rating: 5, context: "Mild winters and hot, sunny summers perfect for outdoor activities." },
                    languageBarrier: { rating: 3, context: "While many speak English, learning some Portuguese is key for full integration." }
                }
            },
            {
                name: "Chiang Mai",
                country: "Thailand",
                continent: "Asia",
                costMonthly: "‚Ç¨700",
                weather: {
                    "max 1 month": "Hot and humid ÔøΩ",
                    "1-3 months": "Monsoon season, with afternoon showers ‚òî",
                    "3+ months": "Pleasant, cooler weather üå¨Ô∏è"
                },
                internetSpeed: "100 Mbps",
                internetReliability: { rating: 4, context: "Feedback this quarter points to generally strong internet, though some remote areas can be spotty." },
                image_url: "https://placehold.co/600x400/3b4252/e2e8f0?text=Chiang+Mai,+Thailand",
                newbie: {
                    costOfLiving: { rating: 5, context: "Over the last 6 months, discussions have confirmed Chiang Mai remains one of the most affordable spots for new nomads." },
                    internetReliability: { rating: 4, context: "Feedback this quarter points to generally strong internet, though some remote areas can be spotty." },
                    safety: { rating: 4, context: "Community sentiment on safety is positive, with most advising caution only with traffic and minor theft." },
                    budget: { rating: 5, context: "The cost of living is consistently rated as excellent for all budgets, from last month's reviews." },
                    environment: { rating: 4, context: "A great balance of city amenities and access to nature, a point of praise for many." }
                },
                experienced: {
                    taxFriendliness: { rating: 3, context: "A recent debate on tax laws has shown some complexity, with most agreeing it's not the most tax-efficient destination." },
                    visaProcess: { rating: 4, context: "Discussions from the last 3 months show that visa extensions and border runs are a common but manageable process." },
                    infrastructure: { rating: 3, context: "Nomads report solid but not world-class infrastructure, with some older areas lacking modern amenities." },
                    budget: { rating: 5, context: "Extremely low cost of living allows experienced nomads to optimize savings or spend more on experiences." },
                    environment: { rating: 4, context: "The laid-back, mountain-city vibe is highly rated by veteran travelers seeking a slower pace." }
                },
                slowmad: {
                    communityVibe: { rating: 4, context: "A large and welcoming community is a frequent topic, with many praising the supportive network." },
                    residencyEase: { rating: 3, context: "Long-term residency is a challenge, and online forums are filled with advice on overcoming bureaucracy." },
                    healthcareQuality: { rating: 3, context: "The consensus is that private healthcare is affordable and good, but public options are less reliable." },
                    budget: { rating: 5, context: "Long-term settlers find the low costs make it easy to stay for extended periods." },
                    environment: { rating: 5, context: "The combination of nature and culture makes it an ideal place to settle for a few months." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 3, context: "Feedback indicates the business scene is growing, but it lacks the legal and financial support of larger hubs." },
                    paymentGateways: { rating: 3, context: "Discussions mention some challenges with setting up international payment systems and local banking." },
                    startupScene: { rating: 3, context: "While there are some meetups, the overall startup scene is considered nascent compared to other destinations." },
                    budget: { rating: 5, context: "Business expenses are very low, making it a great place to test a new idea with minimal overhead." },
                    environment: { rating: 3, context: "The environment is more suited for a 'lifestyle business' than a high-growth startup." }
                },
                hotSecrets: "This month's community consensus is exploring hidden food spots outside the main tourist areas. The sentiment is very positive (5/5 stars).",
                popularity: [3, 4, 4],
                detailedMetrics: {
                    foodCulture: { rating: 5, context: "A paradise for foodies with an endless variety of street food, cafes, and restaurants." },
                    outdoorActivities: { rating: 4, context: "Opportunities for hiking, elephant sanctuaries, and exploring temples in the surrounding mountains." },
                    easeOfGettingAround: { rating: 4, context: "Easy to navigate on a scooter or with ride-hailing apps like Grab." },
                    communitySize: { rating: 5, context: "A very large and active digital nomad community with regular meetups and events." },
                    humidity: { rating: 2, context: "The climate can be very hot and humid, especially during the summer months." }
                }
            },
            {
                name: "Medell√≠n",
                country: "Colombia",
                continent: "South America",
                costMonthly: "‚Ç¨850",
                weather: {
                    "max 1 month": "Perfectly spring-like üå∏",
                    "1-3 months": "Cloudy with sunny intervals üå§Ô∏è",
                    "3+ months": "Pleasant year-round ‚òÄÔ∏è"
                },
                internetSpeed: "300 Mbps",
                internetReliability: { rating: 5, context: "Nomads have a strong positive sentiment towards the widespread fiber optic internet." },
                image_url: "https://placehold.co/600x400/3b4252/e2e8f0?text=Medellin,+Colombia",
                newbie: {
                    costOfLiving: { rating: 4, context: "Recent posts highlight a moderate cost of living, with affordable local goods and services." },
                    internetReliability: { rating: 5, context: "Nomads have a strong positive sentiment towards the widespread fiber optic internet." },
                    safety: { rating: 3, context: "Discussions over the last quarter have led to a moderate rating, with many sharing tips on situational awareness." },
                    budget: { rating: 4, context: "A balanced cost of living means a comfortable lifestyle is achievable on a moderate budget." },
                    environment: { rating: 5, context: "The 'City of Eternal Spring' is consistently praised for its perfect weather and lush greenery." }
                },
                experienced: {
                    taxFriendliness: { rating: 4, context: "The community frequently discusses favorable tax conditions for foreign-sourced income." },
                    visaProcess: { rating: 4, context: "While not the easiest, discussions show that the visa process for long-term stay is well-documented and manageable." },
                    infrastructure: { rating: 4, context: "Nomads appreciate the modern public transport and amenities, particularly in key neighborhoods." },
                    budget: { rating: 4, context: "The affordability allows for a high-quality lifestyle without overspending." },
                    environment: { rating: 4, context: "A great mix of urban energy and access to nature for a well-rounded experience." }
                },
                slowmad: {
                    communityVibe: { rating: 4, context: "A friendly and growing community is a constant topic, with many praising the welcoming locals." },
                    residencyEase: { rating: 4, context: "Discussions on long-term residency are positive, with many finding the process clear and achievable." },
                    healthcareQuality: { rating: 4, context: "Feedback suggests solid healthcare quality, with affordable private options." },
                    budget: { rating: 4, context: "The moderate cost of living is perfect for a long-term base, allowing for stability and savings." },
                    environment: { rating: 5, context: "Ideal for a long-term stay due to its stable, pleasant weather and community feel." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 4, context: "Forum posts mention a supportive business climate, especially for tech and startups." },
                    paymentGateways: { rating: 4, context: "Accepted payment gateways are good, with most popular services available and reliable." },
                    startupScene: { rating: 4, context: "The startup scene is a hot topic, with a growing number of events and networking opportunities." },
                    budget: { rating: 4, context: "Business operating costs are reasonable, and a growing local market offers many opportunities." },
                    environment: { rating: 5, context: "A great place for networking and business growth, while enjoying a high quality of life." }
                },
                hotSecrets: "This month's community consensus is on safety tips and best practices for new arrivals. The sentiment is positive (4/5 stars), with a focus on caution.",
                popularity: [2, 3, 4],
                detailedMetrics: {
                    costOfTransport: { rating: 4, context: "The metro and bus system are very affordable, and taxis are reasonably priced." },
                    foodVariety: { rating: 4, context: "A great mix of traditional Colombian food and international cuisine." },
                    socialScene: { rating: 5, context: "A very active social calendar with meetups, events, and a friendly local population." },
                    natureAccess: { rating: 4, context: "Easy access to hiking trails and beautiful surrounding landscapes." },
                    coWorkingSpaces: { rating: 5, context: "A plethora of modern and well-equipped co-working spaces and coffee shops." }
                }
            },
            {
                name: "Tbilisi",
                country: "Georgia",
                continent: "Europe",
                costMonthly: "‚Ç¨600",
                weather: {
                    "max 1 month": "Warm with a light breeze üå¨Ô∏è",
                    "1-3 months": "Cool and sometimes rainy üåßÔ∏è",
                    "3+ months": "Pleasant but with cold winters ‚ùÑÔ∏è"
                },
                internetSpeed: "150 Mbps",
                internetReliability: { rating: 4, context: "Recent posts praise the general internet speed and reliability, particularly in the city center." },
                image_url: "https://placehold.co/600x400/3b4252/e2e8f0?text=Tbilisi,+Georgia",
                newbie: {
                    costOfLiving: { rating: 5, context: "Consensus is high that Tbilisi offers an exceptionally low cost of living, a key selling point for new nomads." },
                    internetReliability: { rating: 4, context: "Recent posts praise the general internet speed and reliability, particularly in the city center." },
                    safety: { rating: 5, context: "The community overwhelmingly agrees on Tbilisi being one of the safest cities they've visited." },
                    budget: { rating: 5, context: "Tbilisi is rated as one of the most budget-friendly destinations, a huge plus for those starting out." },
                    environment: { rating: 4, context: "A charming blend of history and nature, highly rated for those who love cityscapes with a view of the mountains." }
                },
                experienced: {
                    taxFriendliness: { rating: 5, context: "The 'small business' tax regime is a major draw, with many nomads citing its simplicity." },
                    visaProcess: { rating: 5, context: "The one-year visa-free stay is a frequent topic of praise, simplifying the process immensely for many nationalities." },
                    infrastructure: { rating: 3, context: "Nomads find the infrastructure acceptable but note that some services and roads can be underdeveloped." },
                    budget: { rating: 5, context: "The low cost of living makes it a perfect place for experienced nomads to save money while living comfortably." },
                    environment: { rating: 4, context: "The unique cultural environment is a draw for seasoned travelers looking for a less-traveled path." }
                },
                slowmad: {
                    communityVibe: { rating: 4, context: "A small but growing community is often discussed, with people valuing the tight-knit feel and welcoming atmosphere." },
                    residencyEase: { rating: 5, context: "Long-term residency and business setup is highly discussed and seen as very achievable." },
                    healthcareQuality: { rating: 4, context: "The general sentiment is that while not Western-level, private healthcare is affordable and professional." },
                    budget: { rating: 5, context: "The extreme affordability makes it an excellent choice for a long-term, low-cost base." },
                    environment: { rating: 5, context: "The city's rich history and welcoming local community make it ideal for a long-term stay." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 4, context: "Discussions on starting a small business are positive, thanks to the country's low tax and regulatory environment." },
                    paymentGateways: { rating: 4, context: "Nomads report good support for international payment platforms, with some local banking challenges." },
                    startupScene: { rating: 4, context: "The startup scene is small but active, with a lot of recent buzz about new initiatives." },
                    budget: { rating: 5, context: "Low overhead costs and a simple tax system make it perfect for new or bootstrapped businesses." },
                    environment: { rating: 4, context: "The relaxed atmosphere and favorable business laws are a great combination for entrepreneurs." }
                },
                hotSecrets: "This month's consensus is on navigating the digital nomad visa process and local bureaucracy. The sentiment is mostly neutral (4/5 stars) due to its complexity.",
                popularity: [3, 4, 5],
                detailedMetrics: {
                    wineCulture: { rating: 5, context: "The birthplace of wine, offering unique and delicious local varieties to explore." },
                    hospitality: { rating: 5, context: "Georgians are known for their warm and welcoming nature towards foreigners." },
                    historicalSites: { rating: 4, context: "Rich in history with numerous churches, fortresses, and museums to visit." },
                    transportation: { rating: 3, context: "Public transport is affordable but can be confusing to navigate for newcomers." },
                    cuisine: { rating: 5, context: "Unique and delicious Georgian food with a wide variety of vegetarian options." }
                }
            },
            {
                name: "Mexico City",
                country: "Mexico",
                continent: "South America", // Note: While geographically North America, this is a common grouping in nomad contexts.
                costMonthly: "‚Ç¨1,000",
                weather: {
                    "max 1 month": "Warm and sunny ‚òÄÔ∏è",
                    "1-3 months": "Cloudy with some rain üåßÔ∏è",
                    "3+ months": "Pleasant, with a definitive rainy season ‚òî"
                },
                internetSpeed: "250 Mbps",
                internetReliability: { rating: 4, context: "Feedback over the last 3 months is positive on internet, with high-speed options widely available." },
                newbie: {
                    costOfLiving: { rating: 4, context: "While not the cheapest, recent discussions confirm Mexico City offers great value for a bustling metropolis." },
                    internetReliability: { rating: 4, context: "Feedback over the last 3 months is positive on internet, with high-speed options widely available." },
                    safety: { rating: 3, context: "Safety is a frequent topic, with the community providing many tips on which neighborhoods are safest." },
                    budget: { rating: 4, context: "A balanced cost of living means a comfortable lifestyle is achievable on a moderate budget." },
                    environment: { rating: 5, context: "The 'City of Eternal Spring' is consistently praised for its perfect weather and lush greenery." }
                },
                experienced: {
                    taxFriendliness: { rating: 4, context: "Discussions on tax optimization are common, with many finding a favorable environment for foreign income." },
                    visaProcess: { rating: 4, context: "The community shares many tips for the temporary resident visa, a popular choice for long-term nomads." },
                    infrastructure: { rating: 5, context: "The infrastructure is highly praised, especially the well-developed transport and modern amenities." },
                    budget: { rating: 4, context: "The affordability allows for a high-quality lifestyle without overspending." },
                    environment: { rating: 4, context: "A great mix of urban energy and access to nature for a well-rounded experience." }
                },
                slowmad: {
                    communityVibe: { rating: 5, context: "The large and diverse community is a huge plus, with many reporting a very easy time finding friends and groups." },
                    residencyEase: { rating: 4, context: "Discussions on residency and local integration are positive, with a clear path for those who want to stay long-term." },
                    healthcareQuality: { rating: 4, context: "Nomads agree that private healthcare is excellent and reasonably priced." },
                    budget: { rating: 4, context: "The moderate cost of living is perfect for a long-term base, allowing for stability and savings." },
                    environment: { rating: 5, context: "Ideal for a long-term stay due to its stable, pleasant weather and community feel." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 5, context: "Discussions consistently highlight Mexico City as a major business hub for Latin America, with lots of opportunity." },
                    paymentGateways: { rating: 5, context: "All major payment gateways are well-supported, with few reported issues." },
                    startupScene: { rating: 5, context: "The city's startup scene is a huge draw, with an endless number of events and opportunities reported." },
                    budget: { rating: 4, context: "Business operating costs are reasonable, and a growing local market offers many opportunities." },
                    environment: { rating: 5, context: "A great place for networking and business growth, while enjoying a high quality of life." }
                },
                hotSecrets: "This month, the community is debating the best neighborhoods for tech startups and co-working, with Roma and Condesa leading the conversation. Community consensus is very positive (4/5 stars).",
                popularity: [4, 4, 5],
                detailedMetrics: {
                    cuisine: { rating: 5, context: "A culinary capital with a diverse range of food, from street tacos to world-class fine dining." },
                    culturalExperience: { rating: 5, context: "Endless museums, galleries, and historical sites to explore." },
                    connectivity: { rating: 4, context: "Excellent fiber internet and 5G mobile networks widely available." },
                    businessHub: { rating: 5, context: "A major business center in Latin America with a huge potential market." },
                    airQuality: { rating: 2, context: "Pollution can be an issue, especially during certain times of the year." }
                }
            },
            {
                name: "Budapest",
                country: "Hungary",
                continent: "Europe",
                costMonthly: "‚Ç¨950",
                weather: {
                    "max 1 month": "Pleasant and warm ‚òÄÔ∏è",
                    "1-3 months": "Cooling down with a crisp breeze üçÇ",
                    "3+ months": "Cold, snowy winters ‚ùÑÔ∏è"
                },
                internetSpeed: "220 Mbps",
                internetReliability: { rating: 5, context: "The community consistently rates the internet as excellent, with fast and reliable connections." },
                newbie: {
                    costOfLiving: { rating: 4, context: "Discussions highlight a very affordable cost of living compared to other major European capitals." },
                    internetReliability: { rating: 5, context: "The community consistently rates the internet as excellent, with fast and reliable connections." },
                    safety: { rating: 4, context: "Nomads report a high sense of safety, with posts on common-sense precautions being the main concern." },
                    budget: { rating: 4, context: "A comfortable budget is very achievable, making it a popular choice for new arrivals." },
                    environment: { rating: 4, context: "The grand, historic city is a huge draw for those who love urban exploration." }
                },
                experienced: {
                    taxFriendliness: { rating: 4, context: "Recent discussions on tax residency are positive, especially for those with EU-based businesses." },
                    visaProcess: { rating: 4, context: "Feedback indicates a clear, but sometimes bureaucratic, process for long-term stay." },
                    infrastructure: { rating: 5, context: "The well-developed public transport and modern amenities are a frequent topic of praise." },
                    budget: { rating: 4, context: "The affordability allows for a high-quality lifestyle without overspending." },
                    environment: { rating: 4, context: "The city's lively culture and deep history are a perfect fit for seasoned travelers." }
                },
                slowmad: {
                    communityVibe: { rating: 4, context: "A welcoming, established community is a frequent topic, with many praising the opportunities for social integration." },
                    residencyEase: { rating: 4, context: "Nomads share experiences on the residency process, finding it challenging but rewarding with the right approach." },
                    healthcareQuality: { rating: 5, context: "Community members consistently rate the healthcare as high-quality and affordable." },
                    budget: { rating: 4, context: "Perfectly balanced cost for a long-term base in a major European city." },
                    environment: { rating: 5, context: "The stunning architecture and cultural richness make it an ideal long-term home." }
                },
                entrepreneur: {
                    businessEnvironment: { rating: 4, context: "Posts mention a strong business climate, particularly in the tech and finance sectors." },
                    paymentGateways: { rating: 5, context: "All major payment gateways are supported, with no reported issues from the community." },
                    startupScene: { rating: 4, context: "The startup scene is vibrant, with many reporting an active network of founders and investors." },
                    budget: { rating: 4, context: "Reasonable business costs and a skilled local talent pool are often discussed as key benefits." },
                    environment: { rating: 5, context: "A great city for business with a fantastic work-life balance." }
                },
                hotSecrets: "This month's discussions are focused on the best thermal baths to work from. Community consensus is very positive (5/5 stars) as many have found quiet spots with good WiFi.",
                popularity: [5, 4, 4],
                detailedMetrics: {
                    architecture: { rating: 5, context: "Stunning and diverse architecture, from gothic to art nouveau, is everywhere you look." },
                    costOfLiving: { rating: 4, context: "Very affordable for a European capital, especially for rent and food." },
                    publicTransport: { rating: 5, context: "An excellent public transport system that is reliable and covers the entire city." },
                    nightlife: { rating: 5, context: "Famous for its unique 'ruin bars' and a lively, diverse nightlife scene." },
                    healthcare: { rating: 5, context: "High-quality, affordable healthcare is available to all residents." }
                }
            }
        ];

        // UI elements
        const personaScreen = document.getElementById('persona-screen');
        const customizationScreen = document.getElementById('customization-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const resultsScreen = document.getElementById('results-screen');
        const detailScreen = document.getElementById('detail-screen');
        const customizationQuestions = document.getElementById('customization-questions');
        const destinationList = document.getElementById('destination-list');
        const detailContent = document.getElementById('detail-content');
        const customizationTitle = document.getElementById('customization-title');
        const customizationDescription = document.getElementById('customization-description');
        const newsletterModal = document.getElementById('newsletter-modal');
        const backToResultsBtn = document.getElementById('back-to-results-btn');
        
        let newsletterForm = null;
        let appState = {
            persona: null,
            customizations: {
                budget: null,
                continent: null,
                period: null,
                environment: null,
            },
            currentQuestionIndex: 0,
            isUnlocked: false
        };

        const questions = [
            {
                label: "What's your monthly budget?",
                key: "budget",
                options: [
                    { emoji: "üí∏", text: "Under ‚Ç¨1K", value: "Under ‚Ç¨1K" },
                    { emoji: "üí∞", text: "‚Ç¨1K-‚Ç¨2.5K", value: "‚Ç¨1K-‚Ç¨2.5K" },
                    { emoji: "ü§ë", text: "Over ‚Ç¨2.5K", value: "Over ‚Ç¨2.5K" },
                    { emoji: "ü§î", text: "Not sure", value: "Not sure" }
                ]
            },
            {
                label: "Which continent?",
                key: "continent",
                options: [
                    { emoji: "üá™üá∫", text: "Europe", value: "Europe" },
                    { emoji: "üåè", text: "Asia", value: "Asia" },
                    { emoji: "üåé", text: "S. America", value: "South America" },
                    { emoji: "üó∫Ô∏è", text: "Open to all", value: "Open to all" }
                ]
            },
            {
                label: "How long will you stay?",
                key: "period",
                options: [
                    { emoji: "üèÉ", text: "Max 1 mo.", value: "max 1 month" },
                    { emoji: "üö∂‚Äç‚ôÄÔ∏è", text: "1-3 mos.", value: "1-3 months" },
                    { emoji: "üè°", text: "3+ mos.", value: "3+ months" },
                    { emoji: "ü§î", text: "Not sure", value: "not sure" }
                ]
            },
            {
                label: "What's your preferred environment?",
                key: "environment",
                options: [
                    { emoji: "üèôÔ∏è", text: "City", value: "City" },
                    { emoji: "üèñÔ∏è", text: "Beach", value: "Beach" },
                    { emoji: "üèîÔ∏è", text: "Mountains", value: "Mountains" },
                    { emoji: "üîÑ", text: "Either", value: "Either" }
                ]
            }
        ];

        const personaConfig = {
            newbie: {
                emoji: 'üéí',
                title: 'Newbie Nomad',
                description: 'Just starting your journey?',
                metrics: { costOfLiving: 'Monthly Cost', internetReliability: 'WiFi', safety: 'Safety' }
            },
            experienced: {
                emoji: '‚úàÔ∏è',
                title: 'Experienced Nomad',
                description: 'Looking for a new challenge?',
                metrics: { taxFriendliness: 'Tax Friendly', visaProcess: 'Visa Ease', infrastructure: 'Infrastructure' }
            },
            slowmad: {
                emoji: 'üè°',
                title: 'Slowmad Settler',
                description: 'Ready to settle down?',
                metrics: { communityVibe: 'Community', residencyEase: 'Residency', healthcareQuality: 'Healthcare' }
            },
            entrepreneur: {
                emoji: 'üíº',
                title: 'Digital Entrepreneur',
                description: 'Business first, travel second?',
                metrics: { businessEnvironment: 'Business Env', paymentGateways: 'Payments', startupScene: 'Startup Scene' }
            }
        };

        const renderStars = (rating) => {
            let stars = '';
            for (let i = 0; i < 5; i++) {
                if (i < rating) {
                    stars += `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
                } else {
                    stars += `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
                }
            }
            return `<div class="flex">${stars}</div>`;
        };

        const showScreen = (screenId) => {
            const screens = [personaScreen, customizationScreen, loadingScreen, resultsScreen, detailScreen];
            screens.forEach(screen => {
                if (screen.id === screenId) {
                    screen.classList.remove('hidden');
                } else {
                    screen.classList.add('hidden');
                }
            });
        };

        document.querySelectorAll('.persona-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.persona-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                
                const persona = card.dataset.persona;
                appState.persona = persona;
                
                setTimeout(() => {
                    appState.currentQuestionIndex = 0;
                    renderQuestionScreen();
                    showScreen('customization-screen');
                }, 300);
            });
        });

        const renderQuestionScreen = () => {
            const currentQuestion = questions[appState.currentQuestionIndex];
            const config = personaConfig[appState.persona];
            
            customizationTitle.innerHTML = `${config.emoji} ${config.title}`;
            customizationDescription.textContent = currentQuestion.label;
            
            const optionsHtml = currentQuestion.options.map(option => `
                <button data-question="${currentQuestion.key}" data-option="${option.value}" class="option-card bg-slate-700 py-2 px-4 rounded-full flex items-center justify-center space-x-2">
                    <span class="text-2xl">${option.emoji}</span>
                    <span class="text-lg font-medium">${option.text}</span>
                </button>
            `).join('');

            customizationQuestions.innerHTML = `
                <div class="space-y-4 text-left">
                    <p class="font-semibold">${currentQuestion.label}</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        ${optionsHtml}
                    </div>
                </div>
            `;

            document.querySelectorAll('.option-card').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.option-card').forEach(btn => btn.classList.remove('selected'));
                    e.target.closest('.option-card').classList.add('selected');

                    const questionKey = currentQuestion.key;
                    const optionValue = e.target.closest('.option-card').dataset.option;
                    appState.customizations[questionKey] = optionValue;
                    
                    setTimeout(() => {
                        appState.currentQuestionIndex++;
                        if (appState.currentQuestionIndex < questions.length) {
                            renderQuestionScreen();
                        } else {
                            showScreen('loading-screen');
                            setTimeout(() => {
                                renderDestinationResults(appState.persona);
                                showScreen('results-screen');
                            }, 2000); // Simulate calculation time
                        }
                    }, 300);
                });
            });
        };

        const renderPopularityPlot = (scores) => {
            const maxScore = 5;
            const years = ["'22", "'23", "'24"];
            let barsHtml = '';
            for (let i = 0; i < scores.length; i++) {
                const height = (scores[i] / maxScore) * 100;
                barsHtml += `
                    <div class="flex flex-col items-center">
                        <div class="chart-bar" style="height:${height}px;"></div>
                    </div>
                `;
            }
            return `<div class="flex items-end h-16">${barsHtml}</div>`;
        };

        const renderDestinationResults = (persona) => {
            const config = personaConfig[persona];
            const { budget, continent, period, environment } = appState.customizations;
            document.getElementById('results-title').innerHTML = `Top 5 Destinations for the ${config.title}`;
            document.getElementById('results-description').textContent = `Your picks: Budget (${budget}), Continent (${continent}), Stay (${period}), Environment (${environment})`;

            const topDestinations = destinationData.slice(0, 5).reverse();
            destinationList.innerHTML = '';

            topDestinations.forEach((destination, index) => {
                const rank = 5 - index;
                const isBlurred = rank <= 3;
                const metrics = destination[persona];
                const periodWeather = destination.weather[period] || destination.weather["max 1 month"];
                const isVisible = appState.isUnlocked || !isBlurred;

                const internetRating = metrics?.internetReliability?.rating || 0;
                const internetSpeed = destination.internetSpeed || 'N/A';
                
                const cardHtml = `
                    <div class="relative bg-slate-700 rounded-2xl shadow-xl overflow-hidden w-full">
                        ${isBlurred && !appState.isUnlocked ? `
                            <div class="absolute inset-0 z-10 bg-slate-900 bg-opacity-70 flex flex-col items-center justify-center p-4 rounded-2xl blur-overlay" id="blur-overlay-${rank}">
                                <h3 class="text-white text-2xl font-bold text-center">Unlock Rank #${rank} and the Top 3!</h3>
                                <button onclick="showNewsletterForm()" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-full mt-4 shadow-lg hover:bg-indigo-700 transition-colors duration-300">Unlock Full Access</button>
                            </div>
                        ` : ''}
                        <img src="${destination.image_url}" alt="Image of ${destination.name}" class="w-full h-48 object-cover">
                        <div class="p-4 text-left">
                            <div class="flex items-center mb-2">
                                <span class="rank-badge">Rank #${rank}</span>
                                <h3 class="text-xl font-bold inline-block ml-3">${destination.name}</h3>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">üí∏</span>
                                    <div>
                                        <p class="text-sm font-medium">Monthly Cost</p>
                                        <p class="text-lg font-bold">${destination.costMonthly}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">üì∂</span>
                                    <div>
                                        <p class="text-sm font-medium">Internet Speed</p>
                                        <div class="flex items-center space-x-2">
                                            <p class="text-lg font-bold">${internetSpeed}</p>
                                            ${renderStars(internetRating)}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">‚òÄÔ∏è</span>
                                    <div>
                                        <p class="text-sm font-medium">Weather</p>
                                        <p class="text-sm text-slate-400">${periodWeather}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-2xl">üìà</span>
                                    <div>
                                        <p class="text-sm font-medium">Popularity</p>
                                        ${renderPopularityPlot(destination.popularity)}
                                    </div>
                                </div>
                            </div>
                            
                            ${rank === 4 && !appState.isUnlocked ? `
                                <div class="mt-6 border-t border-slate-600 pt-4 text-center">
                                    <p class="text-base font-semibold text-indigo-400">Unlock Top 3 to see Your Full List!</p>
                                </div>
                            ` : `
                                <div class="mt-6 border-t border-slate-600 pt-4">
                                    <h4 class="text-base font-bold">Community Consensus</h4>
                                    <p class="text-sm text-slate-400 mt-2">${destination.hotSecrets}</p>
                                </div>
                            `}

                            <button class="mt-4 view-more-btn text-indigo-400 hover:text-indigo-200 font-semibold transition-colors duration-300" data-destination-name="${destination.name}" ${!isVisible ? 'disabled' : ''}>View More Details</button>
                        </div>
                    </div>
                `;
                destinationList.innerHTML += cardHtml;
            });
            if (appState.isUnlocked) {
                unblurContent();
            }
            document.querySelectorAll('.view-more-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const destinationName = e.target.dataset.destinationName;
                    const destination = destinationData.find(d => d.name === destinationName);
                    if (destination) {
                        renderDestinationDetail(destination);
                    }
                });
            });
        };
        
        const renderDestinationDetail = (destination) => {
            const persona = appState.persona;
            const metrics = destination[persona] || {};
            const detailedMetricsHtml = Object.keys(metrics).map(key => {
                const metric = metrics[key];
                return `
                    <div class="flex flex-col text-slate-400 py-2 border-b border-slate-700">
                        <div class="flex justify-between items-center">
                            <span class="font-medium capitalize">${key.replace(/([A-Z])/g, ' $1')}</span>
                            ${metric ? renderStars(metric.rating) : ''}
                        </div>
                        <p class="text-xs text-slate-500 mt-1">${metric?.context || 'No community discussion found for this metric.'}</p>
                    </div>
                `;
            }).join('');
            
            const detailHtml = `
                <div class="flex flex-col sm:flex-row items-start space-y-6 sm:space-y-0 sm:space-x-6">
                    <img src="${destination.image_url}" alt="Image of ${destination.name}" class="rounded-2xl w-full sm:w-1/2 object-cover shadow-lg">
                    <div class="w-full sm:w-1/2">
                        <h2 class="text-3xl font-bold">${destination.name}, ${destination.country}</h2>
                        <div class="mt-6">
                            <h3 class="text-xl font-bold">Overview</h3>
                            <p class="text-slate-400 mt-2">${destination.summary}</p>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-xl font-bold">Hottest Secrets</h3>
                            <p class="text-slate-400 mt-2">${destination.hotSecrets}</p>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-xl font-bold">Popularity Over Time</h3>
                            <div class="mt-4 flex items-end">${renderPopularityPlot(destination.popularity)}</div>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-xl font-bold">Additional Insights from the Community</h3>
                            <div class="mt-4 space-y-2">
                                ${detailedMetricsHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            detailContent.innerHTML = detailHtml;
            showScreen('detail-screen');
        };

        backToResultsBtn.addEventListener('click', () => {
            showScreen('results-screen');
        });

        const showNewsletterForm = () => {
            newsletterModal.classList.remove('hidden');
            newsletterForm = document.querySelector('.formkit-form');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', handleFormSubmit, { once: true });
            }
        };

        const hideNewsletterForm = () => {
            newsletterModal.classList.add('hidden');
        };

        const unblurContent = () => {
            appState.isUnlocked = true;
            document.querySelectorAll('[id^="blur-overlay-"]').forEach(overlay => {
                overlay.classList.add('hidden');
            });
            document.querySelectorAll('.view-more-btn').forEach(button => {
                button.disabled = false;
            });
        };
        
        const handleFormSubmit = (e) => {
            e.preventDefault();
            setTimeout(() => {
                hideNewsletterForm();
                unblurContent();
                const messageBox = document.createElement('div');
                messageBox.className = 'fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50';
                messageBox.innerHTML = `
                    <div class="bg-white text-slate-800 rounded-3xl shadow-2xl p-6 max-w-sm w-full text-center">
                        <h3 class="text-2xl font-bold">Success!</h3>
                        <p class="text-gray-600 mt-2">Thank you for subscribing! Your full list is now unlocked.</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-full mt-4 shadow-lg hover:bg-indigo-700 transition-colors duration-300">Close</button>
                    </div>
                `;
                document.body.appendChild(messageBox);
            }, 1000);
        }
    </script>
</body>
</html>
ÔøΩ
