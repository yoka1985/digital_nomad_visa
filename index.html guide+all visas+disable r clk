<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Nomad Visa Matcher | Compare Visas & Requirements 2025</title>
    <meta name="description" content="Instantly compare Digital Nomad Visas from around the world. Filter by income requirements, cost, tax friendliness, and other key metrics to find your perfect match. Updated for 2025." />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6N573S8D8S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', { 'analytics_storage': 'denied' });
        function initGoogleAnalytics() {
            gtag('consent', 'update', { 'analytics_storage': 'granted' });
            gtag('js', new Date());
            gtag('config', 'G-6N573S8D8S');
            console.log("Google Analytics Initialized");
        }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "What is a digital nomad visa?",
        "acceptedAnswer": { "@type": "Answer", "text": "A digital nomad visa is a residence permit that allows remote workers to legally live and work in a foreign country for an extended period (usually one year or more). Unlike tourist visas, they officially sanction remote work for foreign employers." }
      },{
        "@type": "Question",
        "name": "Why do I need a special visa to work remotely?",
        "acceptedAnswer": { "@type": "Answer", "text": "Working while on a standard tourist visa is often illegal and can lead to penalties, including fines or being banned from a country. A digital nomad visa provides legal authorization, clarifies your tax situation, and often gives you access to services like banking and healthcare." }
      }]
    }
    </script>
    
    <style>
        body { background-color: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #334155; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 10px; }
        details > summary { list-style: none; cursor: pointer;}
        details > summary::-webkit-details-marker { display: none; }
        details summary .plus-minus::before { content: '+'; }
        details[open] summary .plus-minus::before { content: '‚àí'; }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA & CONTENT ---
        
        const newsItemsData = [
            { date: 'Coming Late 2025', title: 'Slovenia Plans to Launch New Digital Nomad Visa', content: '<p>Slovenia has announced its intention to launch a dedicated one-year digital nomad visa. Keep an eye on official channels for launch dates and requirements.</p>' },
            { date: 'June 23, 2025', title: 'Philippines launches new Digital Nomad Visa!', content: '<p>The Philippines has officially launched its much-anticipated digital nomad visa, opening its doors to remote workers seeking to live and work in the tropical archipelago. The new visa is available via an online portal.</p>' },
            { date: 'June 18, 2025', title: 'Bulgaria launches new Digital Nomad Visa!', content: '<p>Bulgaria has now formalized its pathway for remote workers with a new Type D visa tailored for digital nomads. This move simplifies the process for non-EU nationals to reside in the country while working for foreign employers.</p>' }
        ];

        const COUNTRY_CODE_MAP = { 'Andorra': 'AD', 'Argentina': 'AR', 'Australia': 'AU', 'Austria': 'AT', 'Brazil': 'BR', 'Bulgaria': 'BG', 'Canada': 'CA', 'Colombia': 'CO', 'Croatia': 'HR', 'Cyprus': 'CY', 'Czech Republic': 'CZ', 'Estonia': 'EE', 'Germany': 'DE', 'Greece': 'GR', 'Hungary': 'HU', 'Iceland': 'IS', 'Indonesia': 'ID', 'Italy': 'IT', 'Japan': 'JP', 'Latvia': 'LV', 'Malaysia': 'MY', 'Malta': 'MT', 'Mauritius': 'MU', 'Mexico': 'MX', 'Montenegro': 'ME', 'Norway': 'NO', 'Panama': 'PA', 'Philippines': 'PH', 'Portugal': 'PT', 'Romania': 'RO', 'South Africa': 'ZA', 'South Korea': 'KR', 'Spain': 'ES', 'Sri Lanka': 'LK', 'Thailand': 'TH', 'UAE (Dubai)': 'AE', 'United Kingdom': 'GB', 'United States': 'US' };
        
        const legalContentTemplate = (dataLegend) => ({
            terms: { title: 'Terms of Use', content: `<p>Welcome to our Digital Nomad Visa Matcher. By using this site, you agree to these terms. The information provided is for general informational purposes only and does not constitute legal advice. We strive to keep the information up-to-date, but we make no representations or warranties of any kind about the completeness, accuracy, or reliability of the information. Any reliance you place on such information is therefore strictly at your own risk. For any questions, please contact us at contact@digitalnomadvisa.help.</p>` },
            privacy: { title: 'Privacy Policy', content: `<p>This Privacy Policy describes how we handle your information. We use Google Analytics to collect anonymous data about website traffic to improve the user experience. This data is aggregated and does not personally identify you. We do not sell, trade, or otherwise transfer your personally identifiable information to outside parties. If you accept our cookie policy, you consent to our use of analytics. For any concerns, please contact us at contact@digitalnomadvisa.help.</p>` },
            about: { title: 'About This Project', story: `My name is Yonatan, and I've been living the digital nomad life for the past several years. With a background in tech, I grew increasingly frustrated with the inconsistent, outdated, and often confusing visa information scattered across the web. \n\nI built this tool to solve my own problem: to create a single, clear, and user-friendly place to compare visa options without the headache. My goal is to reduce the bureaucratic pain for fellow nomads.\n\nData on this site is aggregated from official government websites, reputable legal and immigration blogs, and cross-referenced with validated user experiences from online communities like Reddit.`, dataSources: `Beyond official sources, this tool incorporates validated user experiences from online communities and forums. This provides a crucial layer of 'on-the-ground' reality to balance official documentation.\n\n**Transparency is key:** This project is independent. If any affiliate links are ever used (e.g., for services like insurance or banking), they will be clearly marked. My commitment is to you, the user. Where possible, I will always opt to split or reduce any commission to give you a better deal.`, disclaimer: `Information keeps changing, and updates are currently done on a monthly average, so it's always better to double-check official sources.`, closing: `I hope this serves you well, and I'm always open to suggestions for improvement!`, imageSrc: 'images/ME_ALB.jpg', imageCaption: "Me in Durr√´s beach, Albania, a day before the official end of season (shoulder seasons for the win!)" },
            fieldsExplanation: {
                title: 'Field Guide: Understanding the Scores',
                content: `<p class="mb-4">The scores are rated from 1-5. Here's what they mean:</p>
                        <div class="space-y-4 text-left">
                            <div class="bg-slate-900/50 p-4 rounded-lg"><h4 class="font-bold text-lg text-purple-400">ü§Ø Bureaucracy Level</h4><p class="mt-2 text-sm text-slate-300">${dataLegend?.bureaucracy_level || 'N/A'}</p></div>
                            <div class="bg-slate-900/50 p-4 rounded-lg"><h4 class="font-bold text-lg text-purple-400">üí∞ Cost of Living</h4><p class="mt-2 text-sm text-slate-300">${dataLegend?.cost_of_living || 'N/A'}</p></div>
                            <div class="bg-slate-900/50 p-4 rounded-lg"><h4 class="font-bold text-lg text-purple-400">üí∏ Tax Friendliness</h4><p class="mt-2 text-sm text-slate-300">${dataLegend?.tax_friendliness || 'N/A'}</p></div>
                            <div class="bg-slate-900/50 p-4 rounded-lg"><h4 class="font-bold text-lg text-purple-400">üßæ Social Security Liability</h4><p class="mt-2 text-sm text-slate-300">${dataLegend?.social_security_liability || 'N/A'}</p></div>
                            <div class="bg-slate-900/50 p-4 rounded-lg"><h4 class="font-bold text-lg text-purple-400">üè• Social Security Benefits</h4><p class="mt-2 text-sm text-slate-300">${dataLegend?.social_security_benefits || 'N/A'}</p></div>
                        </div>`
            },
            howToUse: { title: 'How to Use This Tool', content: `<p class="mb-2">This tool is designed to quickly narrow down your visa options. Here's how to get the most out of it:</p><ol class="list-decimal list-inside space-y-2"><li><strong>Select Your Nationality:</strong> This is the most important first step.</li><li><strong>Set Your Income:</strong> Click your approximate monthly income bracket to filter out visas.</li><li><strong>Use Advanced Filters:</strong> Adjust the sliders for visa cost, tax attractiveness, and visa length.</li><li><strong>Review the Cards:</strong> The counter at the top tells you how many visas match your search.</li><li><strong>View Full Details:</strong> Click on any card to open a pop-up with much more information.</li></ol>` },
            faq: { title: 'Visas FAQ', content: `<div class="space-y-4 text-left"><h4 class="font-bold text-lg text-slate-100">What is a digital nomad visa?</h4><p>A digital nomad visa is a residence permit that allows remote workers to legally live and work in a foreign country for an extended period.</p><h4 class="font-bold text-lg text-slate-100">Why do I need a special visa?</h4><p>Working on a tourist visa is often illegal. A DNV provides legal authorization and access to services like banking.</p></div>` },
            countryFaq: { title: 'Country-Specific Visa FAQs', content: `<div class="space-y-4 text-left"><p class="text-slate-400 mb-4">Common questions based on nationality.</p><details class="bg-slate-900/50 p-4 rounded-lg"><summary class="font-bold text-lg text-purple-400">üá∫üá∏ USA</summary><div class="mt-4 space-y-3 border-t border-slate-700 pt-4"><p><strong>Q: Can I use the FEIE on Spain's DNV?</strong><br/>A: Likely no. Spain makes you a tax resident. You pay Spanish taxes and claim a credit on your US return.</p><p><strong>Q: What if my employer won't register in Portugal?</strong><br/>A: Switch to a 1099 independent contractor status before applying.</p></div></details><details class="bg-slate-900/50 p-4 rounded-lg"><summary class="font-bold text-lg text-purple-400">üá¨üáß United Kingdom</summary><div class="mt-4 space-y-3 border-t border-slate-700 pt-4"><p><strong>Q: Can a UK citizen use Spain's DNV?</strong><br/>A: Yes. Post-Brexit, this is a main legal route for Brits to live and work remotely in Spain.</p></div></details></div>` }
        });
        
        const incomeLevels = [ { label: "Any", value: "any", userIncomeForMatch: null }, { label: "< $2k", value: "0-1999", userIncomeForMatch: 1999 }, { label: "$2k-4k", value: "2000-3999", userIncomeForMatch: 3999 }, { label: "$4k+", value: "4000+", userIncomeForMatch: Infinity } ];
        const EU_COUNTRIES = ['Austria', 'Belgium', 'Bulgaria', 'Croatia', 'Cyprus', 'Czech Republic', 'Denmark', 'Estonia', 'Finland', 'France', 'Germany', 'Greece', 'Hungary', 'Ireland', 'Italy', 'Latvia', 'Lithuania', 'Luxembourg', 'Malta', 'Netherlands', 'Poland', 'Portugal', 'Romania', 'Slovakia', 'Slovenia', 'Spain', 'Sweden'];

        // --- UTILITY FUNCTIONS ---

        function getCountryFlagEmoji(countryName) {
            const countryCode = COUNTRY_CODE_MAP[countryName];
            if (!countryCode) return 'üè≥Ô∏è';
            return String.fromCodePoint(...[...countryCode.toUpperCase()].map(char => char.charCodeAt(0) + 127397));
        };

        function nationalityToClusters(nationality) {
            if (EU_COUNTRIES.includes(nationality)) {
                return ['EU Citizen'];
            }
            if (['United States', 'Canada', 'Australia', 'New Zealand', 'Japan', 'South Korea'].includes(nationality)) {
                return ['Non-EU/EEA Nationals', 'OECD Nationals', 'Special Eligibility'];
            }
            if (['United Kingdom'].includes(nationality)) {
                return ['Non-EU/EEA Nationals', 'Special Eligibility'];
            }
            return ['Non-EU/EEA Nationals', 'All Nationalities', 'Country-Specific Nationals'];
        };

        function getScoreAttributes(score, type = 'standard') {
            const invertedDesc = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
            const colors = ['#22c55e', '#84cc16', '#eab308', '#f97316', '#ef4444' ];
            if (score === null || score === undefined || score < 1 || score > 5) {
                return { description: 'N/A', color: '#64748b', percentage: 0 };
            }
            const color = colors[score - 1];
            let description = invertedDesc[score - 1];
            const displayColor = (type === 'bureaucracy_level') ? color : [...colors].reverse()[score - 1];

            if (type === 'bureaucracy_level') {
                description = `${description} Complexity`;
            }
            return { description, color: displayColor, percentage: (score / 5) * 100 };
        };
        
        // --- CHILD COMPONENTS ---

        function NationalitySelector({ selectedNationality, onSelectNationality }) {
            const [searchTerm, setSearchTerm] = React.useState("");
            const [isOpen, setIsOpen] = React.useState(false);
            const POPULAR_COUNTRIES = ['United States', 'United Kingdom', 'Canada', 'Germany', 'France', 'Australia', 'Brazil', 'Russia', 'India', 'Spain', 'Italy', 'Netherlands', 'Sweden', 'Switzerland', 'Ireland', 'Israel', 'South Africa', 'Argentina', 'Mexico', 'China'].sort();
            const allCountries = Object.keys(COUNTRY_CODE_MAP).sort();
            const popularSet = new Set(POPULAR_COUNTRIES);
            const otherCountries = allCountries.filter(c => !popularSet.has(c));

            const renderList = (countryList, isPopular = false) => {
                return countryList
                    .filter(country => country.toLowerCase().includes(searchTerm.toLowerCase()))
                    .map(country => (
                        <li key={country} onClick={() => { onSelectNationality(country); setIsOpen(false); setSearchTerm(""); }} className="p-2 hover:bg-purple-600 cursor-pointer flex items-center gap-2" >
                            <span>{getCountryFlagEmoji(country)}</span>
                            <span>{country}</span>
                            {isPopular && <span className="text-amber-400 text-xs">‚òÖ</span>}
                        </li>
                    ));
            };

            return (
                <div>
                    <label className="block text-sm font-medium text-slate-300 mb-2">üåç Your Nationality</label>
                    <div className="relative">
                        <button onClick={() => setIsOpen(!isOpen)} className="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg shadow-sm text-left flex justify-between items-center" >
                            <span>{selectedNationality ? `${getCountryFlagEmoji(selectedNationality)} ${selectedNationality}` : '-- Select your country --'}</span>
                            <span>‚ñº</span>
                        </button>
                        {isOpen && (
                            <div className="absolute top-full left-0 right-0 mt-2 bg-slate-700 border border-slate-600 rounded-lg shadow-lg z-20">
                                <input type="text" placeholder="Search for your country..." className="w-full p-2 bg-slate-800 text-white border-b border-slate-600 focus:outline-none" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                <ul className="max-h-60 overflow-y-auto custom-scrollbar">
                                    <li className="px-2 pt-2 pb-1 text-xs text-slate-400 font-bold uppercase">Most Popular</li>
                                    {renderList(POPULAR_COUNTRIES, true)}
                                    <hr className="border-slate-500 my-1"/>
                                    {renderList(otherCountries)}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        function NewsFeed({ newsItems, onReadMore }) {
            return (
                <div className="max-w-6xl mx-auto mb-8">
                
                <div class="text-center my-8">
    <a href="./world.html" class="inline-block bg-sky-500 hover:bg-sky-400 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg shadow-sky-500/30">
        <span class="text-xl">üó∫Ô∏è Launch Interactive Visa Map</span>
    </a>
</div>

                    <details className="bg-slate-800/50 rounded-lg overflow-hidden">
                    
                        <summary className="p-4 cursor-pointer flex justify-between items-center">
                        
                        
                            <h3 className="text-lg font-semibold text-purple-400">Latest Updates</h3>
                            <span className="plus-minus text-purple-400 text-xl font-semibold"></span>
                        </summary>
                        <div className="p-4 border-t border-slate-700 grid grid-cols-1 md:grid-cols-3 gap-4">
                            {newsItems.map((item, index) => (
                                <div key={index} className="bg-slate-800 p-4 rounded-lg flex flex-col">
                                    <p className="text-xs text-slate-400 mb-1">{item.date}</p>
                                    <h4 className="font-semibold text-slate-200 mb-2 flex-grow">{item.title}</h4>
                                    <button onClick={() => onReadMore(item)} className="text-sm text-purple-400 hover:text-purple-300 self-start mt-auto">Read more...</button>
                                </div>
                            ))}
                        </div>
                    </details>
                </div>
            );
        };

        function CookieBanner({ onAccept }) {
            return (
                <div className="fixed bottom-0 left-0 right-0 bg-slate-900/80 backdrop-blur-sm p-4 border-t border-slate-700 z-50">
                    <div className="max-w-4xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-center sm:text-left">
                        <p className="text-sm text-slate-300">This site uses cookies for analytics to improve your experience.</p>
                        <button onClick={onAccept} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg whitespace-nowrap">Accept</button>
                    </div>
                </div>
            );
        };
<div class="text-center my-8">
    <a href="./world.html" class="inline-block bg-sky-500 hover:bg-sky-400 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg shadow-sky-500/30">
        <span class="text-xl">üó∫Ô∏è Launch Interactive Visa Map</span>
    </a>
</div>
        function LegalModal({ data, onClose }) {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center pb-4 border-b border-slate-700">
                            <h2 className="text-2xl font-bold text-purple-400">{data.title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-3xl font-light">&times;</button>
                        </div>
                        <div className="mt-6 text-slate-300 text-sm space-y-4 leading-relaxed">
                            {data.imageSrc && (
                                <div className="text-center mb-6">
                                    <img src={data.imageSrc} alt="Project Founder Yonatan" className="mx-auto rounded-full object-cover border-4 border-purple-400" style={{objectPosition: "95% 50%", width:"38%", height:"auto"}}/>
                                    <p className="text-xs text-slate-400 mt-2 italic">{data.imageCaption}</p>
                                </div>
                            )}
                            {data.story && data.story.split('\n').map((p, i) => <p key={`s-${i}`} className="mb-2 last:mb-0">{p}</p>)}
                            {data.dataSources && (<div className="p-4 mt-4 bg-slate-900/50 rounded-lg text-slate-300" dangerouslySetInnerHTML={{ __html: data.dataSources.replace(/\n/g, '<br/><br/>') }} />)}
                            {data.disclaimer && <p className="p-3 mt-4 text-yellow-300 bg-yellow-900/50 rounded-lg">{data.disclaimer}</p>}
                            {data.closing && <p className="mt-4 italic">{data.closing}</p>}
                            {data.content && <div dangerouslySetInnerHTML={{ __html: data.content }} />}
                        </div>
                    </div>
                </div>
            );
        };
        
        const RatingBar = ({ score, type }) => {
            const { color, percentage } = getScoreAttributes(score, type);
            return (
                <div title={`${score}/5`} className="w-full bg-slate-700 rounded-full h-2.5">
                    <div className="h-2.5 rounded-full" style={{ width: `${percentage}%`, backgroundColor: color }}></div>
                </div>
            );
        };

        function VisaCard({ country, visa, onViewDetails }) {
            if (!visa) return null;
            const { description, color } = getScoreAttributes(country.ratings?.bureaucracy_level, 'bureaucracy_level');
            return (
                <div className="bg-slate-800 shadow-xl rounded-lg p-5 flex flex-col justify-between transition-all hover:shadow-purple-500/30 hover:scale-[1.02] duration-300">
                    <div>
                        <h3 className="text-xl font-bold text-purple-400 mb-2 min-h-[3.5rem]">
                            {getCountryFlagEmoji(country.country_name)} {country.country_name} ‚Äì <span className="font-normal text-slate-300">{visa.visa_name}</span>
                        </h3>
                        <div className="space-y-3 text-sm mb-4">
                            <p>‚è≥<span className="font-semibold"> Duration:</span> {visa.visa_length_months ? `${visa.visa_length_months} months` : 'N/A'}</p>
                            <p>üí∏<span className="font-semibold"> Income:</span> {visa.income_requirement_usd_month ? `~$${visa.income_requirement_usd_month.toLocaleString()}/mo` : 'Not specified'}</p>
                            <p className="flex items-center gap-2">
                                <span className="font-semibold">ü§Ø Bureaucracy:</span>
                                <span className="font-bold" style={{ color: color }}>{description}</span>
                            </p>
                        </div>
                    </div>
                    <div className="mt-auto pt-4 border-t border-slate-700/50">
                        <button className="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition" onClick={() => onViewDetails({ ...country, visas: [visa] })}>
                            View Full Details
                        </button>
                    </div>
                </div>
            );
        };

        const DetailSection = ({ title, data }) => {
            if (!data || Object.keys(data).length === 0) return null;
            return (
                <div className="bg-slate-900/50 p-4 rounded-lg">
                    <h3 className="text-lg font-semibold text-slate-200 mb-3">{title}</h3>
                    <div className="space-y-2 text-sm text-slate-300">
                        {Object.entries(data).map(([key, value]) => value && (
                            <p key={key}>
                                <strong className="text-slate-400 capitalize">{key.replace(/_/g, ' ')}:</strong> {String(value)}
                            </p>
                        ))}
                    </div>
                </div>
            );
        };
        
        function ScoreDetailItem({ label, score, type, explanation }) {
            if (score === null || score === undefined) return null;
            return (
                <details className="bg-slate-900/50 rounded-lg overflow-hidden">
                    <summary className="p-4 cursor-pointer">
                        <div className="flex justify-between items-center mb-2">
                            <span className="font-semibold text-slate-200">{label}</span>
                            <span className="plus-minus text-purple-400 text-xl font-semibold"></span>
                        </div>
                        <RatingBar score={score} type={type} />
                    </summary>
                    <div className="border-t border-slate-700/50 px-4 pt-3 pb-4">
                        <p className="text-sm text-slate-300 whitespace-pre-wrap">{explanation}</p>
                    </div>
                </details>
            );
        };

        function DetailsModal({ country, onClose }) {
            const visa = country.visas?.[0];
            if (!visa) return null;
            const { ratings, tax_system, social_security, bureaucracy } = country;
            const formatObjectToString = (obj) => {
                if (!obj) return "No details available.";
                return Object.entries(obj).map(([key, value]) => `${key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase())}:\n${value}`).join('\n\n');
            };
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4" onClick={onClose}>
                    <div className="bg-slate-800 rounded-xl shadow-2xl p-6 md:p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-start pb-4 border-b border-slate-700 mb-6">
                            <div className="flex-grow">
                                <h2 className="text-3xl font-bold text-purple-400 flex items-center gap-4">
                                    <span>{getCountryFlagEmoji(country.country_name)} {country.country_name}</span>
                                </h2>
                                <p className="text-slate-400 mt-1">{visa.visa_name}</p>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white text-4xl font-light">&times;</button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <DetailSection title="üîë Key Information" data={{ "Duration": `${visa.visa_length_months} months`, "Cost (est.)": visa.visa_cost_usd ? `$${visa.visa_cost_usd}`: 'N/A', "Minimum Income": visa.income_requirement_usd_month ? `$${visa.income_requirement_usd_month.toLocaleString()}/month`: 'Not specified', "Eligible Nationalities": visa.eligible_citizens_cluster }} />
                                <div>
                                    <a href="#" target="_blank" rel="noopener noreferrer" className="block w-full text-center bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                                        üìö View Step-by-Step Application Guide
                                    </a>
                                </div>
                                {visa.remarks && <DetailSection title="üìù Remarks" data={{ "Note": visa.remarks }} />}
                            </div>
                            <div className="space-y-4">
                                <h3 className="text-xl font-semibold text-slate-100 mb-2">Attractiveness Scores</h3>
                                <ScoreDetailItem label="üí∏ Tax Friendliness" score={ratings?.tax_friendliness} type="standard" explanation={formatObjectToString(tax_system)} />
                                <ScoreDetailItem label="ü§Ø Bureaucracy Level" score={ratings?.bureaucracy_level} type="bureaucracy_level" explanation={formatObjectToString(bureaucracy)} />
                                <ScoreDetailItem label="üßæ Social Security Liability" score={ratings?.social_security_liability} type="social_security_liability" explanation={formatObjectToString(social_security?.contribution_rates)} />
                                <ScoreDetailItem label="üè• Social Security Benefits" score={ratings?.social_security_benefits} type="standard" explanation={formatObjectToString(social_security?.benefits)} />
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        function App() {
            const [selectedNationality, setSelectedNationality] = React.useState('');
            const [selectedIncomeValue, setSelectedIncomeValue] = React.useState("any");
            const [maxVisaCost, setMaxVisaCost] = React.useState(4000);
            const [minTaxAttractiveness, setMinTaxAttractiveness] = React.useState(1);
            const [minVisaLength, setMinVisaLength] = React.useState(1);
            const [visaData, setVisaData] = React.useState([]);
            const [dataLegend, setDataLegend] = React.useState(null);
            const [modalContent, setModalContent] = React.useState(null);
            const [legalModalContent, setLegalModalContent] = React.useState(null);
            const [newsModalContent, setNewsModalContent] = React.useState(null);
            const [showBanner, setShowBanner] = React.useState(false);
            const [isLoading, setIsLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            
            React.useEffect(() => { if (localStorage.getItem('ga_consent') !== 'true') setShowBanner(true); else initGoogleAnalytics(); }, []);
            
            React.useEffect(() => {
                const fetchData = async () => {
                    setIsLoading(true);
                    setError(null);
                    try {
                        const response = await fetch('./data/data.json');
                        if (!response.ok) { throw new Error(`HTTP error! Status: ${response.status}`); }
                        const jsonData = await response.json();
                        if (!Array.isArray(jsonData) || jsonData.length < 2) { throw new Error("JSON data is not a valid array or is missing data."); }
                        setDataLegend(jsonData[0]);
                        const countryData = jsonData.slice(1);
                        const specialOrder = ["Spain", "Portugal", "Bulgaria", "Croatia", "Argentina"];
                        countryData.sort((a, b) => { const aIndex = specialOrder.indexOf(a.country_name); const bIndex = specialOrder.indexOf(b.country_name); if (aIndex === -1 && bIndex === -1) return a.country_name.localeCompare(b.country_name); if (aIndex === -1) return 1; if (bIndex === -1) return -1; return aIndex - bIndex; });
                        setVisaData(countryData);
                    } catch (e) {
                        console.error("Failed to fetch visa data:", e);
                        setError("Could not load visa data. Please ensure the 'data/data.json' file is available in the same directory as this HTML file.");
                    } finally {
                        setIsLoading(false);
                    }
                };
                fetchData();
            }, []);

            const filteredVisas = React.useMemo(() => {
                const incomeOption = incomeLevels.find(level => level.value === selectedIncomeValue);
                const userIncome = incomeOption?.userIncomeForMatch;
                const userClusters = selectedNationality ? nationalityToClusters(selectedNationality) : [];
                const isEU = userClusters.includes('EU Citizen');

                if (!visaData || visaData.length === 0) {
                    return [];
                }

                const allPossibleVisas = visaData.flatMap(country =>
                    country.visas && Array.isArray(country.visas) ? country.visas.map(visa => ({ country, visa })) : []
                );

                return allPossibleVisas.filter(({ country, visa }) => {
                    if (selectedNationality) {
                        if (isEU && EU_COUNTRIES.includes(country.country_name)) return false;
                        const visaIsEligible = userClusters.includes(visa.eligible_citizens_cluster);
                        const isOpenToAll = visa.eligible_citizens_cluster === "All Nationalities";
                        if (!visaIsEligible && !isOpenToAll) return false;
                    }

                    if (userIncome !== null && visa.income_requirement_usd_month && visa.income_requirement_usd_month > userIncome) return false;
                    if (visa.visa_cost_usd > maxVisaCost) return false;
                    if (country.ratings?.tax_friendliness < minTaxAttractiveness) return false;
                    if (visa.visa_length_months < minVisaLength) return false;
                    
                    return true;
                });
            }, [visaData, selectedNationality, selectedIncomeValue, maxVisaCost, minTaxAttractiveness, minVisaLength]);
            
            const handleConsent = () => { localStorage.setItem('ga_consent', 'true'); setShowBanner(false); if (typeof initGoogleAnalytics === 'function') initGoogleAnalytics(); };
            const legalContent = legalContentTemplate(dataLegend);
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 font-sans p-4 sm:p-6 md:p-8">
                    <header className="text-center mb-4 max-w-3xl mx-auto"> <h1 className="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">Visa Match & Clarity Engine</h1> <p className="text-slate-400 mt-2">Instantly find your digital nomad visa options worldwide.</p> </header>
                    <div className="flex justify-center items-center flex-wrap gap-4 my-8"> <button onClick={() => setLegalModalContent(legalContent.about)} className="inline-block bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">üí° About This Project</button> <button onClick={() => setLegalModalContent(legalContent.fieldsExplanation)} className="inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">üìñ Field Guide</button> <button onClick={() => setLegalModalContent(legalContent.howToUse)} className="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">‚öôÔ∏è How to Use</button> </div>
                    <div className="bg-slate-800 shadow-2xl rounded-xl p-6 mb-8 max-w-6xl mx-auto"> <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start"> <div className="space-y-6"> <NationalitySelector selectedNationality={selectedNationality} onSelectNationality={setSelectedNationality} /> <div> <label className="block text-sm font-medium text-slate-300 mb-2">üí∞ Est. Monthly Income (USD)</label> <div className="flex flex-wrap gap-2"> {incomeLevels.map(level => ( <button key={level.value} onClick={() => setSelectedIncomeValue(level.value)} className={`px-3 py-2 text-sm rounded-md transition-all ${selectedIncomeValue === level.value ? 'bg-purple-600 text-white shadow-lg ring-2 ring-purple-400' : 'bg-slate-700 hover:bg-slate-600 text-slate-300'}`}>{level.label}</button>))}</div> </div> </div> <div className="space-y-6 bg-slate-900/50 p-4 rounded-lg"> <h3 className="text-lg font-semibold text-purple-400">Advanced Filters</h3> <div className="space-y-4"> <div className="text-sm"> <label className="flex justify-between font-medium text-slate-300 mb-1"><span>üí∏ Max Visa Cost</span><span>${maxVisaCost}</span></label> <input type="range" min="0" max="4000" step="50" value={maxVisaCost} onChange={e => setMaxVisaCost(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/> </div> <div className="text-sm"> <label className="flex justify-between font-medium text-slate-300 mb-1"><span>üëç Min Tax Attractiveness</span><span>{minTaxAttractiveness}/5</span></label> <input type="range" min="1" max="5" step="1" value={minTaxAttractiveness} onChange={e => setMinTaxAttractiveness(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/> </div> <div className="text-sm"> <label className="flex justify-between font-medium text-slate-300 mb-1"><span>‚è≥ Min Visa Length</span><span>{minVisaLength} months</span></label> <input type="range" min="1" max="60" step="1" value={minVisaLength} onChange={e => setMinVisaLength(e.target.value)} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"/> </div> </div> </div> </div> </div>
                    <NewsFeed newsItems={newsItemsData} onReadMore={setNewsModalContent} />
                    <main className="mt-8 max-w-7xl mx-auto"> {isLoading ? ( <p className="text-center text-slate-400 text-lg">Loading Visa Data...</p> ) : error ? ( <div className="text-center text-red-400 bg-red-900/50 p-4 rounded-lg">{error}</div> ) : ( <> <div className="mb-6 text-center"> <h2 className="text-2xl font-bold text-slate-300"> Showing <span className="text-purple-400">{filteredVisas.length}</span> Matching Visa Options </h2> {visaData.length > 0 && filteredVisas.length === 0 && <p className="text-slate-400 mt-2">No visas match your current criteria. Try adjusting filters.</p>} </div> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> {filteredVisas.map(({ country, visa }, index) => ( <VisaCard key={`${country.country_name}-${visa.visa_name || index}`} country={country} visa={visa} onViewDetails={setModalContent} /> ))} </div> </> )} </main>
                    <footer className="text-center mt-12 pt-6 border-t border-slate-700"> <div className="flex justify-center items-center flex-wrap gap-x-4 gap-y-2 text-xs text-slate-500"> <button onClick={() => setLegalModalContent(legalContent.terms)} className="hover:text-purple-400 transition">Terms of Use</button> <span>|</span> <button onClick={() => setLegalModalContent(legalContent.privacy)} className="hover:text-purple-400 transition">Privacy Policy</button> <span>|</span> <button onClick={() => setLegalModalContent(legalContent.faq)} className="hover:text-purple-400 transition">Visas FAQ</button> <span>|</span> <button onClick={() => setLegalModalContent(legalContent.countryFaq)} className="hover:text-purple-400 transition">Country-Specific FAQs</button> <span>|</span> <a href="mailto:contact@digitalnomadvisa.help" className="hover:text-purple-400 transition">Contact</a> </div> </footer>
                    {modalContent && <DetailsModal country={modalContent} onClose={() => setModalContent(null)} />}
                    {legalModalContent && <LegalModal data={legalModalContent} onClose={() => setLegalModalContent(null)} />}
                    {newsModalContent && <LegalModal data={newsModalContent} onClose={() => setNewsModalContent(null)} />}
                    {showBanner && <CookieBanner onAccept={handleConsent} />}
                </div>
            );
        }
        
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
